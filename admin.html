<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MBTECH | Unified Admin & CRM Portal</title>
    
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon" type="image/png" href="favicon.png">

    <!-- Preconnect for performance optimization -->
    <link rel="preconnect" href="https://esm.sh" crossorigin />
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://esm.sh" />
    <link rel="dns-prefetch" href="https://www.gstatic.com" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Tailwind CSS (Deferred for faster initial parse) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    colors: { 
                        brand: { 
                            blue: '#0056b3', 
                            blueHover: '#004494', 
                            orange: '#f97316',
                            dark: '#0f172a'
                        } 
                    }
                }
            }
        }
    </script>

    <!-- Import Map for React, Icons, and Firebase -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.292.0?bundle",
            "firebase/app": "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"
        }
    }
    </script>
    <!-- Babel standalone for in-browser JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>

    <style>
        /* Smooth Mobile Scrolling for Data Tables */
        .smooth-scroll {
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }
        
        /* Animations */
        .animate-fade-in { animation: fadeIn 0.4s ease-out; }
        .animate-fade-in-up { animation: fadeInUp 0.4s ease-out; }
        .animate-scale-in { animation: scaleIn 0.3s ease-out; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        @keyframes indeterminate {
            0% { transform: translateX(-100%) scaleX(0.2); }
            50% { transform: translateX(0) scaleX(0.5); }
            100% { transform: translateX(100%) scaleX(0.2); }
        }
        .animate-progress { animation: indeterminate 1.5s infinite linear; }
        
        /* Initial Loader Spinner */
        @keyframes spinFast { to { transform: rotate(360deg); } }
        .native-loader-spinner {
            width: 48px; height: 48px;
            border: 4px solid #e2e8f0; border-top-color: #0056b3;
            border-radius: 50%; animation: spinFast 1s linear infinite;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 antialiased overflow-hidden">
    
    <!-- Root Container with Instant Feedback Pre-loader -->
    <div id="root">
        <div style="display: flex; height: 100vh; width: 100vw; align-items: center; justify-content: center; background-color: #f8fafc; font-family: sans-serif; flex-direction: column; gap: 16px;">
            <div class="native-loader-spinner"></div>
            <p style="color: #64748b; font-weight: 600; font-size: 14px; letter-spacing: 0.5px;">Loading Unified Workspace...</p>
        </div>
    </div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo, Suspense } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            LayoutDashboard, Users, ShoppingCart, Send, Settings, LogOut, 
            Search, Filter, Mail, Lock, AlertCircle, ArrowRight,
            CheckCircle, Clock, XCircle, Menu, X, Trash2, Package, MessageSquare, Plus, Edit
        } from 'lucide-react';

        // Firebase Setup
        import { initializeApp } from 'firebase/app';
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, signInAnonymously } from 'firebase/auth';
        import { getFirestore, collection, onSnapshot, doc, setDoc, updateDoc, deleteDoc } from 'firebase/firestore';

        // Configuration setup
        let firebaseConfig = {};
        try {
            firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
                apiKey: "", authDomain: "", projectId: "", storageBucket: "", messagingSenderId: "", appId: ""
            };
        } catch (e) {}

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'mbtech-crm';

        // --- Mock Data (Used ONLY to seed an empty database initially) ---
        const initialOrders = [
            { id: 'ORD-1023', customer: 'John Doe', email: 'john@example.com', date: '2026-02-26', total: 45000, status: 'Completed', payment: 'Paid' },
            { id: 'ORD-1024', customer: 'Sarah Smith', email: 'sarah@example.com', date: '2026-02-27', total: 120000, status: 'Processing', payment: 'Pending' }
        ];

        const initialCustomers = [
            { id: 'CUST-01', name: 'John Doe', email: 'john@example.com', totalOrders: 5, spent: 250000, joinDate: '2025-11-10' },
            { id: 'CUST-02', name: 'Sarah Smith', email: 'sarah@example.com', totalOrders: 2, spent: 120000, joinDate: '2026-01-15' }
        ];

        const initialProducts = [
            { id: 'PROD-01', name: 'Advanced Web Development Course', price: 45000, stock: 999, status: 'Active', category: 'Course' },
            { id: 'PROD-02', name: 'Premium UI/UX Masterclass', price: 65000, stock: 50, status: 'Active', category: 'Course' },
            { id: 'PROD-03', name: 'MBTECH Branded Hoodie', price: 15000, stock: 0, status: 'Out of Stock', category: 'Merchandise' }
        ];

        const initialMessages = [
            { id: 'MSG-01', name: 'David Okafor', email: 'david@example.com', subject: 'Inquiry about Web Course', date: '2026-02-27', status: 'Unread' },
            { id: 'MSG-02', name: 'Grace Emmanuel', email: 'grace@example.com', subject: 'Partnership Proposal', date: '2026-02-26', status: 'Read' }
        ];

        // --- UI Components ---
        const Toast = ({ message, type, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            const bgColor = type === 'success' ? 'bg-green-600' : type === 'error' ? 'bg-red-500' : 'bg-brand-blue';
            return (
                <div className={`fixed bottom-6 right-6 left-6 sm:left-auto ${bgColor} text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 z-50 animate-fade-in-up`}>
                    {type === 'success' ? <CheckCircle size={20} className="shrink-0"/> : <AlertCircle size={20} className="shrink-0"/>}
                    <span className="font-bold text-sm flex-1">{message}</span>
                    <button onClick={onClose} className="ml-2 hover:opacity-75 transition-opacity p-1"><X size={18}/></button>
                </div>
            );
        };

        const OrderDetailsModal = ({ order, onClose, onUpdateStatus, onUpdatePaymentStatus }) => {
            if (!order) return null;

            return (
                <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fade-in">
                    <div className="bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden animate-scale-in max-h-[90vh] flex flex-col">
                        <div className="p-5 sm:p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                            <h3 className="text-xl font-extrabold text-brand-dark truncate pr-4">Order {order.id}</h3>
                            <button onClick={onClose} className="text-slate-400 hover:text-red-500 hover:bg-red-50 p-2 rounded-full transition-all shrink-0">
                                <X size={20} />
                            </button>
                        </div>
                        <div className="p-5 sm:p-6 space-y-6 overflow-y-auto">
                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6 bg-slate-50 p-4 rounded-xl">
                                <div className="sm:col-span-2">
                                    <p className="text-xs text-slate-500 font-bold mb-1 uppercase tracking-wider">Customer</p>
                                    <p className="font-extrabold text-slate-800">{order.customer}</p>
                                    <p className="text-sm text-slate-500 font-medium truncate">{order.email}</p>
                                </div>
                                <div>
                                    <p className="text-xs text-slate-500 font-bold mb-1 uppercase tracking-wider">Order Date</p>
                                    <p className="font-bold text-slate-800">{order.date}</p>
                                </div>
                                <div>
                                    <p className="text-xs text-slate-500 font-bold mb-1 uppercase tracking-wider">Total Amount</p>
                                    <p className="font-extrabold text-brand-blue text-lg">₦{order.total.toLocaleString()}</p>
                                </div>
                            </div>
                            
                            <div className="space-y-5">
                                <div>
                                    <label className="text-sm text-slate-700 font-bold mb-2 block">Update Order Status</label>
                                    <select 
                                        value={order.status}
                                        onChange={(e) => onUpdateStatus(order.id, e.target.value)}
                                        className="w-full p-3.5 rounded-xl border border-slate-200 bg-white font-medium focus:outline-none focus:border-brand-blue focus:ring-4 focus:ring-brand-blue/10 transition-all appearance-none cursor-pointer"
                                    >
                                        <option value="Pending">Pending Validation</option>
                                        <option value="Processing">Processing Order</option>
                                        <option value="Completed">Completed & Delivered</option>
                                        <option value="Cancelled">Cancelled</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="text-sm text-slate-700 font-bold mb-2 block">Update Payment Status</label>
                                    <select 
                                        value={order.payment}
                                        onChange={(e) => onUpdatePaymentStatus(order.id, e.target.value)}
                                        className="w-full p-3.5 rounded-xl border border-slate-200 bg-white font-medium focus:outline-none focus:border-brand-blue focus:ring-4 focus:ring-brand-blue/10 transition-all appearance-none cursor-pointer"
                                    >
                                        <option value="Pending">Pending Payment</option>
                                        <option value="Paid">Confirmed Paid</option>
                                        <option value="Failed">Payment Failed</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div className="p-5 border-t border-slate-100 bg-slate-50 flex justify-end">
                            <button onClick={onClose} className="w-full sm:w-auto px-8 py-3.5 sm:py-3 bg-slate-200 text-slate-700 font-bold rounded-xl hover:bg-slate-300 transition-colors">
                                Done
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const GlobalFooter = () => (
            <footer className="py-6 mt-auto text-center text-slate-500 text-sm font-medium border-t border-slate-200 bg-white flex flex-col items-center justify-center gap-1 z-20">
                <p>&copy; {new Date().getFullYear()} MBTECH. All rights reserved.</p>
                <p>Designed by <a href="https://wa.me/2347044318043" target="_blank" rel="noopener noreferrer" className="text-brand-orange font-bold hover:underline transition-all p-1">Emmy Kingz</a></p>
            </footer>
        );

        // --- Authentication / Login Screen ---
        const LoginScreen = ({ onLogin }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');
                const success = await onLogin(email, password);
                if (!success) {
                    setError('Invalid access credentials. Please try again or check your account permissions.');
                }
                setLoading(false);
            };

            return (
                <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4">
                    <div className="max-w-md w-full bg-white rounded-[2rem] shadow-xl shadow-slate-200/50 p-6 sm:p-10 border border-slate-100 animate-fade-in-up">
                        <div className="text-center mb-8">
                            <div className="inline-flex items-center justify-center w-16 h-16 bg-brand-blue rounded-2xl mb-5 shadow-lg shadow-brand-blue/30">
                                <Lock className="text-white" size={32} />
                            </div>
                            <h1 className="text-2xl font-extrabold text-brand-dark">Unified Portal</h1>
                            <p className="text-slate-500 mt-2 font-medium text-sm">Sign in to MBTECH CRM & Admin to manage your workspace.</p>
                        </div>
                        
                        {error && (
                            <div className="bg-red-50 text-red-600 p-4 rounded-xl text-sm mb-6 flex items-start sm:items-center gap-3 font-semibold animate-fade-in">
                                <AlertCircle size={18} className="shrink-0 mt-0.5 sm:mt-0" /> <span className="flex-1">{error}</span>
                            </div>
                        )}

                        <form onSubmit={handleSubmit} className="space-y-5">
                            <div>
                                <label className="block text-sm font-bold text-slate-700 mb-2">Admin Email</label>
                                <div className="relative">
                                    <Mail className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" size={20} />
                                    <input 
                                        type="email" 
                                        value={email} 
                                        onChange={(e) => setEmail(e.target.value)} 
                                        required 
                                        className="w-full pl-12 pr-4 py-3.5 rounded-xl border border-slate-200 bg-slate-50 focus:bg-white focus:outline-none focus:border-brand-blue focus:ring-4 focus:ring-brand-blue/10 transition-all font-medium text-slate-800" 
                                        placeholder="admin@mbtech.ng" 
                                    />
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-bold text-slate-700 mb-2">Secure Password</label>
                                <div className="relative">
                                    <Lock className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" size={20} />
                                    <input 
                                        type="password" 
                                        value={password} 
                                        onChange={(e) => setPassword(e.target.value)} 
                                        required 
                                        className="w-full pl-12 pr-4 py-3.5 rounded-xl border border-slate-200 bg-slate-50 focus:bg-white focus:outline-none focus:border-brand-blue focus:ring-4 focus:ring-brand-blue/10 transition-all font-medium text-slate-800" 
                                        placeholder="••••••••" 
                                    />
                                </div>
                            </div>
                            <button 
                                type="submit" 
                                disabled={loading}
                                className="w-full bg-brand-dark hover:bg-slate-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5 flex justify-center items-center gap-2 text-base mt-2 disabled:opacity-70 disabled:hover:translate-y-0"
                            >
                                {loading ? 'Authenticating...' : 'Secure Login'} <ArrowRight size={18} />
                            </button>
                        </form>
                        
                        <div className="mt-8 pt-6 border-t border-slate-100 text-center">
                            <p className="text-xs text-slate-400 font-bold uppercase tracking-wider mb-2">Authorized Users</p>
                            <div className="text-xs text-slate-500 font-medium space-y-1 break-words">
                                <p>Super Admin: emmanuel.amobi03@gmail.com</p>
                                <p>Admins: mesobest2000@gmail.com <br className="sm:hidden"/> | mesobest.technology.org@gmail.com</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main CRM Application ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [userEmail, setUserEmail] = useState('');
            const [authChecked, setAuthChecked] = useState(false);
            const [isSuperAdmin, setIsSuperAdmin] = useState(false);
            const [isSyncing, setIsSyncing] = useState(false);

            const [activeTab, setActiveTab] = useState('dashboard');
            const [orders, setOrders] = useState([]);
            const [customers, setCustomers] = useState([]);
            const [products, setProducts] = useState([]);
            const [messages, setMessages] = useState([]);
            
            const [selectedOrder, setSelectedOrder] = useState(null);
            const [toast, setToast] = useState(null);
            const [selectedEmails, setSelectedEmails] = useState(new Set());
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

            // Allowed Roles
            const SUPER_ADMIN_EMAIL = 'emmanuel.amobi03@gmail.com';
            const ALLOWED_ADMINS = [SUPER_ADMIN_EMAIL, 'mesobest2000@gmail.com', 'mesobest.technology.org@gmail.com'];

            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, (firebaseUser) => {
                    if (firebaseUser) {
                        const email = firebaseUser.email || localStorage.getItem('mock_canvas_email');
                        if (ALLOWED_ADMINS.includes(email)) {
                            setUser(firebaseUser);
                            setUserEmail(email);
                            setIsSuperAdmin(email === SUPER_ADMIN_EMAIL);
                        } else {
                            setUser(null);
                            signOut(auth);
                        }
                    } else {
                        setUser(null);
                        setUserEmail('');
                        setIsSuperAdmin(false);
                    }
                    setAuthChecked(true);
                });
                return () => unsubscribe();
            }, []);

            // Real-time Firestore Sync (Background Fetching)
            useEffect(() => {
                if (!user) return;
                
                setIsSyncing(true);
                
                const ordersRef = collection(db, 'artifacts', appId, 'public', 'data', 'orders');
                const customersRef = collection(db, 'artifacts', appId, 'public', 'data', 'customers');
                const productsRef = collection(db, 'artifacts', appId, 'public', 'data', 'products');
                const messagesRef = collection(db, 'artifacts', appId, 'public', 'data', 'messages');

                let oLoaded = false, cLoaded = false, pLoaded = false, mLoaded = false;
                const checkDone = () => { if (oLoaded && cLoaded && pLoaded && mLoaded) setIsSyncing(false); };

                const unsubOrders = onSnapshot(ordersRef, (snapshot) => {
                    if (snapshot.empty && isSuperAdmin && !oLoaded) {
                        initialOrders.forEach(o => setDoc(doc(ordersRef, o.id), o));
                    } else {
                        setOrders(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    }
                    oLoaded = true; checkDone();
                }, (e) => { console.error("Orders sync error", e); checkDone(); });

                const unsubCustomers = onSnapshot(customersRef, (snapshot) => {
                    if (snapshot.empty && isSuperAdmin && !cLoaded) {
                         initialCustomers.forEach(c => setDoc(doc(customersRef, c.id), c));
                    } else {
                        setCustomers(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    }
                    cLoaded = true; checkDone();
                }, (e) => { console.error("Customers sync error", e); checkDone(); });

                const unsubProducts = onSnapshot(productsRef, (snapshot) => {
                    if (snapshot.empty && isSuperAdmin && !pLoaded) {
                         initialProducts.forEach(p => setDoc(doc(productsRef, p.id), p));
                    } else {
                        setProducts(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    }
                    pLoaded = true; checkDone();
                }, (e) => { console.error("Products sync error", e); checkDone(); });

                const unsubMessages = onSnapshot(messagesRef, (snapshot) => {
                    if (snapshot.empty && isSuperAdmin && !mLoaded) {
                         initialMessages.forEach(m => setDoc(doc(messagesRef, m.id), m));
                    } else {
                        setMessages(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    }
                    mLoaded = true; checkDone();
                }, (e) => { console.error("Messages sync error", e); checkDone(); });

                return () => { unsubOrders(); unsubCustomers(); unsubProducts(); unsubMessages(); };
            }, [user, isSuperAdmin]);


            const handleLogin = async (email, password) => {
                try {
                    if (!ALLOWED_ADMINS.includes(email)) return false;
                    await signInWithEmailAndPassword(auth, email, password);
                    return true;
                } catch (error) {
                    if ((error.code === 'auth/user-not-found' || error.code === 'auth/operation-not-allowed') && typeof __firebase_config !== 'undefined') {
                        if (ALLOWED_ADMINS.includes(email)) {
                            await signInAnonymously(auth);
                            localStorage.setItem('mock_canvas_email', email);
                            return true;
                        }
                    }
                    return false;
                }
            };

            const handleLogout = async () => {
                await signOut(auth);
                localStorage.removeItem('mock_canvas_email');
                showToast('Logged out securely.', 'success');
            };

            const showToast = (message, type = 'success') => setToast({ message, type });

            const updateOrderStatus = async (id, newStatus) => {
                try { await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', id), { status: newStatus }); showToast(`Order status updated to ${newStatus}`); } 
                catch (e) { showToast('Failed to update status', 'error'); }
            };

            const updatePaymentStatus = async (id, newStatus) => {
                try { await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', id), { payment: newStatus }); showToast(`Payment status updated to ${newStatus}`); } 
                catch (e) { showToast('Failed to update payment', 'error'); }
            };

            const toggleMessageStatus = async (msg) => {
                const newStatus = msg.status === 'Read' ? 'Unread' : 'Read';
                try { await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'messages', msg.id), { status: newStatus }); } 
                catch (e) { showToast('Failed to update message', 'error'); }
            };

            const deleteItem = async (collectionName, id, label) => {
                if (!isSuperAdmin) return showToast("Permission denied.", "error");
                try {
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', collectionName, id));
                    showToast(`${label} deleted successfully.`);
                } catch (e) {
                    showToast(`Failed to delete ${label.toLowerCase()}`, 'error');
                }
            };

            const handleEmailCampaign = () => {
                if (selectedEmails.size === 0) return showToast('Please select at least one recipient to launch.', 'error');
                showToast(`Campaign initiated! Sent to ${selectedEmails.size} recipients. AI Bot handler required for delivery.`, 'success');
                setSelectedEmails(new Set());
            };

            const toggleEmailSelection = (email) => {
                const newSet = new Set(selectedEmails);
                if (newSet.has(email)) newSet.delete(email); else newSet.add(email);
                setSelectedEmails(newSet);
            };

            const selectAllEmails = (e) => {
                if (e.target.checked) setSelectedEmails(new Set(customers.map(c => c.email)));
                else setSelectedEmails(new Set());
            };

            const totalRevenue = useMemo(() => orders.reduce((sum, o) => o.payment === 'Paid' ? sum + o.total : sum, 0), [orders]);
            const unreadMessagesCount = useMemo(() => messages.filter(m => m.status === 'Unread').length, [messages]);

            if (!authChecked) {
                // Return null to let the native HTML spinner in <div id="root"> keep showing
                return null; 
            }

            if (!user) {
                return (
                    <div className="h-screen w-full">
                        <LoginScreen onLogin={handleLogin} />
                        {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
                    </div>
                );
            }

            return (
                <div className="flex h-screen overflow-hidden bg-slate-50 font-sans relative">
                    {/* Data Sync Progress Bar */}
                    {isSyncing && (
                        <div className="absolute top-0 left-0 w-full h-1 bg-slate-200 z-50 overflow-hidden">
                            <div className="h-full bg-brand-orange animate-progress w-full origin-left"></div>
                        </div>
                    )}

                    {/* Mobile Menu Backdrop */}
                    {mobileMenuOpen && (
                        <div 
                            className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-30 lg:hidden transition-opacity animate-fade-in"
                            onClick={() => setMobileMenuOpen(false)}
                        />
                    )}

                    {/* Sidebar Navigation */}
                    <aside className={`fixed inset-y-0 left-0 bg-brand-dark text-white w-64 shadow-2xl transform ${mobileMenuOpen ? 'translate-x-0' : '-translate-x-full'} lg:translate-x-0 transition-transform duration-300 z-40 flex flex-col`}>
                        <div className="p-6 flex items-center justify-between border-b border-slate-800 mt-1">
                            <div className="text-2xl font-extrabold tracking-tight">MBTECH<span className="text-brand-orange">.NG</span></div>
                            <button className="lg:hidden text-slate-400 hover:text-white p-2 -mr-2" onClick={() => setMobileMenuOpen(false)}>
                                <X size={24}/>
                            </button>
                        </div>
                        
                        <nav className="flex-1 px-4 py-8 space-y-2 overflow-y-auto smooth-scroll">
                            <p className="px-4 text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Analytics & CRM</p>
                            <button onClick={() => {setActiveTab('dashboard'); setMobileMenuOpen(false);}} className={`w-full flex items-center gap-3 px-4 py-3.5 rounded-xl font-bold transition-all ${activeTab === 'dashboard' ? 'bg-brand-blue text-white shadow-lg shadow-brand-blue/20' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>
                                <LayoutDashboard size={20} /> Dashboard Overview
                            </button>
                            <button onClick={() => {setActiveTab('orders'); setMobileMenuOpen(false);}} className={`w-full flex items-center gap-3 px-4 py-3.5 rounded-xl font-bold transition-all ${activeTab === 'orders' ? 'bg-brand-blue text-white shadow-lg shadow-brand-blue/20' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>
                                <ShoppingCart size={20} /> Orders & Fulfillment
                            </button>
                            <button onClick={() => {setActiveTab('customers'); setMobileMenuOpen(false);}} className={`w-full flex items-center gap-3 px-4 py-3.5 rounded-xl font-bold transition-all ${activeTab === 'customers' ? 'bg-brand-blue text-white shadow-lg shadow-brand-blue/20' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>
                                <Users size={20} /> Customers & Marketing
                            </button>

                            <p className="px-4 text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 mt-6">Store Admin</p>
                            <button onClick={() => {setActiveTab('products'); setMobileMenuOpen(false);}} className={`w-full flex items-center gap-3 px-4 py-3.5 rounded-xl font-bold transition-all ${activeTab === 'products' ? 'bg-brand-blue text-white shadow-lg shadow-brand-blue/20' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>
                                <Package size={20} /> Products & Courses
                            </button>
                            <button onClick={() => {setActiveTab('messages'); setMobileMenuOpen(false);}} className={`w-full flex items-center justify-between px-4 py-3.5 rounded-xl font-bold transition-all ${activeTab === 'messages' ? 'bg-brand-blue text-white shadow-lg shadow-brand-blue/20' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>
                                <div className="flex items-center gap-3"><MessageSquare size={20} /> Leads & Connect</div>
                                {unreadMessagesCount > 0 && <span className="bg-brand-orange text-white text-xs px-2 py-0.5 rounded-full">{unreadMessagesCount}</span>}
                            </button>

                        </nav>

                        <div className="p-4 border-t border-slate-800 bg-slate-900/50">
                            <div className="flex items-center gap-3 px-4 py-3 mb-3">
                                <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold shadow-inner shrink-0 ${isSuperAdmin ? 'bg-brand-orange' : 'bg-brand-blue'}`}>
                                    {isSuperAdmin ? 'SA' : 'AD'}
                                </div>
                                <div className="overflow-hidden">
                                    <p className="text-sm font-bold text-white truncate">{isSuperAdmin ? 'Super Admin' : 'Admin'}</p>
                                    <p className="text-xs font-medium text-slate-400 truncate">{userEmail}</p>
                                </div>
                            </div>
                            <button onClick={handleLogout} className="w-full flex items-center justify-center gap-2 px-4 py-3.5 bg-slate-800 text-slate-300 hover:bg-red-500 hover:text-white rounded-xl font-bold transition-all">
                                <LogOut size={18} /> Secure Sign Out
                            </button>
                        </div>
                    </aside>

                    {/* Main Content Area */}
                    <div className="flex-1 flex flex-col min-w-0 lg:ml-64 relative h-full">
                        {/* Topbar */}
                        <header className="bg-white shadow-sm border-b border-slate-200 sticky top-0 z-20">
                            <div className="flex items-center justify-between px-4 sm:px-8 py-4 mt-1">
                                <div className="flex items-center gap-4">
                                    <button className="lg:hidden text-slate-600 bg-slate-100 p-2.5 rounded-lg active:scale-95 transition-transform" onClick={() => setMobileMenuOpen(true)}>
                                        <Menu size={22} />
                                    </button>
                                    <h2 className="text-xl sm:text-2xl font-extrabold text-brand-dark capitalize truncate">
                                        {activeTab === 'customers' ? 'CRM & Marketing' : activeTab.replace('-', ' ')}
                                    </h2>
                                </div>
                                <div className="flex items-center gap-4">
                                    <div className="relative hidden md:block">
                                        <Search className="absolute left-3.5 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
                                        <input type="text" placeholder="Search data..." className="pl-10 pr-4 py-2.5 bg-slate-100 border border-transparent rounded-xl focus:border-brand-blue focus:bg-white focus:ring-4 focus:ring-brand-blue/10 transition-all text-sm font-medium w-64 lg:w-80 outline-none" />
                                    </div>
                                </div>
                            </div>
                        </header>

                        {/* Views */}
                        <main className="flex-1 overflow-y-auto p-4 sm:p-8 bg-slate-50/50 smooth-scroll">
                            
                            {/* --- DASHBOARD TAB --- */}
                            {activeTab === 'dashboard' && (
                                <div className="space-y-6 sm:space-y-8 animate-fade-in pb-8">
                                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
                                        <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 flex items-center gap-5 hover:shadow-md transition-shadow">
                                            <div className="w-16 h-16 bg-blue-50 text-brand-blue rounded-2xl flex items-center justify-center shadow-inner shrink-0"><ShoppingCart size={32}/></div>
                                            <div className="overflow-hidden">
                                                <p className="text-slate-500 font-bold text-sm mb-1 truncate">Total Orders</p>
                                                <h4 className="text-3xl font-extrabold text-brand-dark">{orders.length}</h4>
                                            </div>
                                        </div>
                                        <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 flex items-center gap-5 hover:shadow-md transition-shadow">
                                            <div className="w-16 h-16 bg-green-50 text-green-600 rounded-2xl flex items-center justify-center shadow-inner shrink-0"><Settings size={32}/></div>
                                            <div className="overflow-hidden">
                                                <p className="text-slate-500 font-bold text-sm mb-1 truncate">Total Revenue</p>
                                                <h4 className="text-2xl sm:text-3xl font-extrabold text-brand-dark truncate">₦{totalRevenue.toLocaleString()}</h4>
                                            </div>
                                        </div>
                                        <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 flex items-center gap-5 hover:shadow-md transition-shadow">
                                            <div className="w-16 h-16 bg-orange-50 text-brand-orange rounded-2xl flex items-center justify-center shadow-inner shrink-0"><Users size={32}/></div>
                                            <div className="overflow-hidden">
                                                <p className="text-slate-500 font-bold text-sm mb-1 truncate">Customers</p>
                                                <h4 className="text-3xl font-extrabold text-brand-dark">{customers.length}</h4>
                                            </div>
                                        </div>
                                        <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 flex items-center gap-5 hover:shadow-md transition-shadow">
                                            <div className="w-16 h-16 bg-purple-50 text-purple-600 rounded-2xl flex items-center justify-center shadow-inner shrink-0"><MessageSquare size={32}/></div>
                                            <div className="overflow-hidden">
                                                <p className="text-slate-500 font-bold text-sm mb-1 truncate">New Leads</p>
                                                <h4 className="text-3xl font-extrabold text-brand-dark">{unreadMessagesCount}</h4>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden">
                                        <div className="p-5 sm:p-8 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                                            <h3 className="text-lg font-extrabold text-brand-dark">Recent Transactions</h3>
                                            <button onClick={() => setActiveTab('orders')} className="text-sm font-bold text-brand-blue hover:text-brand-blueHover px-4 py-2 bg-blue-50 rounded-lg transition-colors">View All</button>
                                        </div>
                                        <div className="overflow-x-auto smooth-scroll">
                                            <table className="w-full text-left border-collapse min-w-[600px]">
                                                <thead>
                                                    <tr className="bg-white text-slate-400 text-xs uppercase tracking-wider border-b border-slate-100">
                                                        <th className="p-4 sm:p-5 font-bold">Order ID</th>
                                                        <th className="p-4 sm:p-5 font-bold">Customer Name</th>
                                                        <th className="p-4 sm:p-5 font-bold">Amount</th>
                                                        <th className="p-4 sm:p-5 font-bold">Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="text-sm font-semibold text-slate-700">
                                                    {orders.slice(0, 5).map(order => (
                                                        <tr key={order.id} className="border-b border-slate-50 hover:bg-slate-50 transition-colors cursor-pointer" onClick={() => setSelectedOrder(order)}>
                                                            <td className="p-4 sm:p-5 text-brand-blue font-extrabold">{order.id}</td>
                                                            <td className="p-4 sm:p-5">{order.customer}</td>
                                                            <td className="p-4 sm:p-5">₦{order.total.toLocaleString()}</td>
                                                            <td className="p-4 sm:p-5">
                                                                <span className={`px-3 py-1.5 rounded-lg text-xs font-bold inline-block whitespace-nowrap ${
                                                                    order.status === 'Completed' ? 'bg-green-100 text-green-700' :
                                                                    order.status === 'Processing' ? 'bg-blue-100 text-blue-700' :
                                                                    'bg-orange-100 text-orange-700'
                                                                }`}>
                                                                    {order.status}
                                                                </span>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                    {orders.length === 0 && !isSyncing && (
                                                        <tr><td colSpan="4" className="p-8 text-center text-slate-500 font-medium">No recent transactions found.</td></tr>
                                                    )}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* --- ORDERS TAB --- */}
                            {activeTab === 'orders' && (
                                <div className="space-y-6 animate-fade-in pb-8">
                                    <div className="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden">
                                        <div className="p-5 sm:p-8 border-b border-slate-100 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-slate-50/50">
                                            <div>
                                                <h3 className="text-lg font-extrabold text-brand-dark">All Orders</h3>
                                                <p className="text-sm text-slate-500 font-medium mt-1">Manage and track customer fulfillment.</p>
                                            </div>
                                        </div>
                                        <div className="overflow-x-auto smooth-scroll">
                                            <table className="w-full text-left border-collapse min-w-[900px]">
                                                <thead>
                                                    <tr className="bg-white text-slate-400 text-xs uppercase tracking-wider border-b border-slate-100">
                                                        <th className="p-5 font-bold pl-6">Order Details</th>
                                                        <th className="p-5 font-bold">Customer Info</th>
                                                        <th className="p-5 font-bold">Amount</th>
                                                        <th className="p-5 font-bold">Payment</th>
                                                        <th className="p-5 font-bold">Status</th>
                                                        <th className="p-5 font-bold text-right pr-6">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="text-sm font-semibold text-slate-700">
                                                    {orders.map(order => (
                                                        <tr key={order.id} className="border-b border-slate-50 hover:bg-slate-50 transition-colors">
                                                            <td className="p-5 pl-6">
                                                                <div className="font-extrabold text-brand-dark">{order.id}</div>
                                                                <div className="text-xs text-slate-500 mt-1">{order.date}</div>
                                                            </td>
                                                            <td className="p-5">
                                                                <div className="font-bold">{order.customer}</div>
                                                                <div className="text-xs text-slate-500 font-medium mt-1">{order.email}</div>
                                                            </td>
                                                            <td className="p-5 font-extrabold">₦{order.total.toLocaleString()}</td>
                                                            <td className="p-5">
                                                                <span className={`px-2.5 py-1 rounded-md text-xs font-bold inline-flex items-center gap-1 whitespace-nowrap ${
                                                                    order.payment === 'Paid' ? 'text-green-700 bg-green-50 border border-green-200' : 'text-orange-700 bg-orange-50 border border-orange-200'
                                                                }`}>
                                                                    {order.payment === 'Paid' ? <CheckCircle size={12}/> : <Clock size={12}/>}
                                                                    {order.payment}
                                                                </span>
                                                            </td>
                                                            <td className="p-5">
                                                                <span className={`px-3 py-1.5 rounded-lg text-xs font-bold inline-block whitespace-nowrap ${
                                                                    order.status === 'Completed' ? 'bg-green-100 text-green-700' :
                                                                    order.status === 'Processing' ? 'bg-blue-100 text-blue-700' :
                                                                    'bg-orange-100 text-orange-700'
                                                                }`}>
                                                                    {order.status}
                                                                </span>
                                                            </td>
                                                            <td className="p-5 text-right flex items-center justify-end gap-2 pr-6">
                                                                <button onClick={() => setSelectedOrder(order)} className="px-5 py-2.5 bg-slate-100 text-slate-700 rounded-lg text-sm font-bold hover:bg-slate-200 transition-colors whitespace-nowrap">
                                                                    Edit / Manage
                                                                </button>
                                                                {isSuperAdmin && (
                                                                    <button onClick={() => deleteItem('orders', order.id, 'Order')} className="p-2.5 bg-red-50 text-red-500 hover:bg-red-500 hover:text-white rounded-lg transition-colors" title="Delete permanently">
                                                                        <Trash2 size={18} />
                                                                    </button>
                                                                )}
                                                            </td>
                                                        </tr>
                                                    ))}
                                                    {orders.length === 0 && !isSyncing && (
                                                        <tr><td colSpan="6" className="p-8 text-center text-slate-500 font-medium">No orders found.</td></tr>
                                                    )}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* --- CUSTOMERS & CRM TAB --- */}
                            {activeTab === 'customers' && (
                                <div className="space-y-6 animate-fade-in pb-8">
                                    <div className="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden">
                                        <div className="p-5 sm:p-8 border-b border-slate-100 bg-slate-50/50">
                                            <h3 className="text-lg font-extrabold text-brand-dark mb-1">Customer Database</h3>
                                            <p className="text-sm text-slate-500 font-medium">Select users below to bulk-send email marketing campaigns or promos.</p>
                                        </div>
                                        
                                        <div className="overflow-x-auto smooth-scroll">
                                            <table className="w-full text-left border-collapse min-w-[900px]">
                                                <thead>
                                                    <tr className="bg-white text-slate-400 text-xs uppercase tracking-wider border-b border-slate-100">
                                                        <th className="p-5 w-16 text-center pl-6">
                                                            <input 
                                                                type="checkbox" 
                                                                className="w-4.5 h-4.5 rounded border-slate-300 text-brand-blue focus:ring-brand-blue cursor-pointer"
                                                                checked={selectedEmails.size === customers.length && customers.length > 0}
                                                                onChange={selectAllEmails}
                                                            />
                                                        </th>
                                                        <th className="p-5 font-bold">Customer Name</th>
                                                        <th className="p-5 font-bold">Email Address</th>
                                                        <th className="p-5 font-bold text-center">Orders</th>
                                                        <th className="p-5 font-bold">Total Spent</th>
                                                        {isSuperAdmin && <th className="p-5 font-bold text-right pr-6">Action</th>}
                                                    </tr>
                                                </thead>
                                                <tbody className="text-sm font-semibold text-slate-700">
                                                    {customers.map(customer => (
                                                        <tr key={customer.id} className="border-b border-slate-50 hover:bg-slate-50 transition-colors">
                                                            <td className="p-5 text-center pl-6">
                                                                <input 
                                                                    type="checkbox" 
                                                                    className="w-4.5 h-4.5 rounded border-slate-300 text-brand-blue focus:ring-brand-blue cursor-pointer"
                                                                    checked={selectedEmails.has(customer.email)}
                                                                    onChange={() => toggleEmailSelection(customer.email)}
                                                                />
                                                            </td>
                                                            <td className="p-5">
                                                                <div className="flex items-center gap-3">
                                                                    <div className="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-xs font-bold text-slate-500 shrink-0">
                                                                        {customer.name.charAt(0)}
                                                                    </div>
                                                                    <span className="font-bold text-brand-dark whitespace-nowrap">{customer.name}</span>
                                                                </div>
                                                            </td>
                                                            <td className="p-5 text-slate-500">{customer.email}</td>
                                                            <td className="p-5 text-center">
                                                                <span className="bg-slate-100 text-slate-600 px-3 py-1 rounded-full text-xs font-bold">{customer.totalOrders}</span>
                                                            </td>
                                                            <td className="p-5 font-extrabold text-brand-blue">₦{customer.spent.toLocaleString()}</td>
                                                            
                                                            {isSuperAdmin && (
                                                                <td className="p-5 text-right pr-6">
                                                                    <button onClick={() => deleteItem('customers', customer.id, 'Customer')} className="p-2.5 bg-red-50 text-red-500 hover:bg-red-500 hover:text-white rounded-lg transition-colors" title="Delete customer">
                                                                        <Trash2 size={18} />
                                                                    </button>
                                                                </td>
                                                            )}
                                                        </tr>
                                                    ))}
                                                    {customers.length === 0 && !isSyncing && (
                                                        <tr><td colSpan={isSuperAdmin ? "6" : "5"} className="p-8 text-center text-slate-500 font-medium">No customers found.</td></tr>
                                                    )}
                                                </tbody>
                                            </table>
                                        </div>
                                        
                                        <div className="p-5 sm:p-8 bg-slate-50 border-t border-slate-100">
                                            <div className="flex flex-col sm:flex-row items-center justify-between gap-4 sm:gap-6">
                                                <div className="text-sm font-bold text-slate-500 flex items-center gap-2">
                                                    <Users size={18} className="text-brand-blue"/> {selectedEmails.size} Recipients Selected
                                                </div>
                                                <button onClick={handleEmailCampaign} className="w-full sm:w-auto px-8 py-4 bg-brand-dark text-white rounded-xl font-bold shadow-lg hover:bg-slate-800 transition-all flex items-center justify-center gap-2">
                                                    <Send size={18}/> Launch AI Promo Campaign
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* --- PRODUCTS & STORE ADMIN TAB --- */}
                            {activeTab === 'products' && (
                                <div className="space-y-6 animate-fade-in pb-8">
                                    <div className="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden">
                                        <div className="p-5 sm:p-8 border-b border-slate-100 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-slate-50/50">
                                            <div>
                                                <h3 className="text-lg font-extrabold text-brand-dark">Store Catalog</h3>
                                                <p className="text-sm text-slate-500 font-medium mt-1">Manage physical products and digital courses.</p>
                                            </div>
                                            <button className="flex justify-center items-center gap-2 px-5 py-2.5 bg-brand-blue text-white rounded-xl font-bold text-sm hover:bg-brand-blueHover shadow-md transition-all">
                                                <Plus size={16} /> Add Product
                                            </button>
                                        </div>
                                        <div className="overflow-x-auto smooth-scroll">
                                            <table className="w-full text-left border-collapse min-w-[900px]">
                                                <thead>
                                                    <tr className="bg-white text-slate-400 text-xs uppercase tracking-wider border-b border-slate-100">
                                                        <th className="p-5 font-bold pl-6">Product Code</th>
                                                        <th className="p-5 font-bold">Item Name</th>
                                                        <th className="p-5 font-bold">Category</th>
                                                        <th className="p-5 font-bold">Price</th>
                                                        <th className="p-5 font-bold">Status</th>
                                                        <th className="p-5 font-bold text-right pr-6">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="text-sm font-semibold text-slate-700">
                                                    {products.map(product => (
                                                        <tr key={product.id} className="border-b border-slate-50 hover:bg-slate-50 transition-colors">
                                                            <td className="p-5 pl-6 font-extrabold text-brand-dark">{product.id}</td>
                                                            <td className="p-5 font-bold">{product.name}</td>
                                                            <td className="p-5 text-slate-500">{product.category}</td>
                                                            <td className="p-5 font-extrabold text-brand-blue">₦{product.price.toLocaleString()}</td>
                                                            <td className="p-5">
                                                                <span className={`px-3 py-1.5 rounded-lg text-xs font-bold inline-block whitespace-nowrap ${
                                                                    product.status === 'Active' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'
                                                                }`}>
                                                                    {product.status} {product.status === 'Active' ? `(${product.stock})` : ''}
                                                                </span>
                                                            </td>
                                                            <td className="p-5 text-right flex items-center justify-end gap-2 pr-6">
                                                                <button className="p-2.5 bg-slate-100 text-slate-700 hover:bg-slate-200 rounded-lg transition-colors" title="Edit">
                                                                    <Edit size={18} />
                                                                </button>
                                                                {isSuperAdmin && (
                                                                    <button onClick={() => deleteItem('products', product.id, 'Product')} className="p-2.5 bg-red-50 text-red-500 hover:bg-red-500 hover:text-white rounded-lg transition-colors" title="Delete">
                                                                        <Trash2 size={18} />
                                                                    </button>
                                                                )}
                                                            </td>
                                                        </tr>
                                                    ))}
                                                    {products.length === 0 && !isSyncing && (
                                                        <tr><td colSpan="6" className="p-8 text-center text-slate-500 font-medium">No products available.</td></tr>
                                                    )}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* --- LEADS & CONNECT TAB --- */}
                            {activeTab === 'messages' && (
                                <div className="space-y-6 animate-fade-in pb-8">
                                    <div className="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden">
                                        <div className="p-5 sm:p-8 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                                            <div>
                                                <h3 className="text-lg font-extrabold text-brand-dark">Connect Inquiries</h3>
                                                <p className="text-sm text-slate-500 font-medium mt-1">Review messages and lead requests.</p>
                                            </div>
                                        </div>
                                        <div className="overflow-x-auto smooth-scroll">
                                            <table className="w-full text-left border-collapse min-w-[800px]">
                                                <thead>
                                                    <tr className="bg-white text-slate-400 text-xs uppercase tracking-wider border-b border-slate-100">
                                                        <th className="p-5 font-bold pl-6 w-16">Status</th>
                                                        <th className="p-5 font-bold">Contact Info</th>
                                                        <th className="p-5 font-bold">Subject / Date</th>
                                                        <th className="p-5 font-bold text-right pr-6">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="text-sm font-semibold text-slate-700">
                                                    {messages.map(msg => (
                                                        <tr key={msg.id} className={`border-b border-slate-50 hover:bg-slate-50 transition-colors ${msg.status === 'Unread' ? 'bg-orange-50/30' : ''}`}>
                                                            <td className="p-5 pl-6 text-center">
                                                                <div className={`w-3 h-3 rounded-full mx-auto ${msg.status === 'Unread' ? 'bg-brand-orange animate-pulse' : 'bg-slate-300'}`}></div>
                                                            </td>
                                                            <td className="p-5">
                                                                <div className={`font-bold ${msg.status === 'Unread' ? 'text-brand-dark' : 'text-slate-600'}`}>{msg.name}</div>
                                                                <div className="text-xs text-slate-500 font-medium mt-1">{msg.email}</div>
                                                            </td>
                                                            <td className="p-5">
                                                                <div className="font-bold text-brand-dark">{msg.subject}</div>
                                                                <div className="text-xs text-slate-500 mt-1">{msg.date}</div>
                                                            </td>
                                                            <td className="p-5 text-right flex items-center justify-end gap-2 pr-6">
                                                                <button onClick={() => toggleMessageStatus(msg)} className="px-4 py-2 bg-slate-100 text-slate-700 rounded-lg text-xs font-bold hover:bg-slate-200 transition-colors">
                                                                    Mark {msg.status === 'Read' ? 'Unread' : 'Read'}
                                                                </button>
                                                                {isSuperAdmin && (
                                                                    <button onClick={() => deleteItem('messages', msg.id, 'Message')} className="p-2 bg-red-50 text-red-500 hover:bg-red-500 hover:text-white rounded-lg transition-colors" title="Delete">
                                                                        <Trash2 size={16} />
                                                                    </button>
                                                                )}
                                                            </td>
                                                        </tr>
                                                    ))}
                                                    {messages.length === 0 && !isSyncing && (
                                                        <tr><td colSpan="4" className="p-8 text-center text-slate-500 font-medium">No messages found.</td></tr>
                                                    )}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            )}

                        </main>
                    </div>
                    
                    <OrderDetailsModal order={selectedOrder} onClose={() => setSelectedOrder(null)} onUpdateStatus={updateOrderStatus} onUpdatePaymentStatus={updatePaymentStatus} />
                    {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
                    <GlobalFooter />
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
