<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mbtech Admin Portal | Workspace</title>
    
    <!-- Security Headers & Search Engine Directives -->
    <meta name="robots" content="noindex, nofollow">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta name="referrer" content="strict-origin-when-cross-origin">

    <link rel="icon" type="image/png" href="favicon.png">

    <!-- Fonts (Mbtech Brand Font: Plus Jakarta Sans) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    colors: { 
                        brand: { 
                            50: '#f0f7ff', 
                            100: '#e0effe', 
                            500: '#0056b3', 
                            600: '#004494', 
                            700: '#003370', 
                            900: '#001a38',
                            orange: '#f97316'
                        } 
                    }
                }
            }
        }
    </script>

    <!-- Import Map: Defines where to load libraries from -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.294.0",
            "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
        }
    }
    </script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: #f8fafc; overflow-x: hidden; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .modal-overlay { animation: fadeIn 0.2s ease-out; }
        .modal-content { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
    </style>
</head>
<body class="text-slate-800 antialiased min-h-screen flex flex-col">
    <div id="root" class="flex-1 flex flex-col"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            LayoutDashboard, Store as StoreIcon, Calendar as Event, FileText as Info, 
            BookOpen as Course, Users, Settings, Plus, Edit, Trash2 as Delete, X as Close, 
            LogOut, Lock, Check, RefreshCcw as Sync, MapPin as Location, Phone, Mail, ShieldAlert,
            Loader2 
        } from 'lucide-react';

        // --- FIREBASE IMPORTS ---
        import { initializeApp } from 'firebase/app';
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithPopup, GoogleAuthProvider, signInWithEmailAndPassword } from 'firebase/auth';
        import { getFirestore, collection, onSnapshot, addDoc, updateDoc, deleteDoc, doc, serverTimestamp } from 'firebase/firestore';

        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyDRkEVsI2swGV5cgn_0gMHTIWUbLhsacfY",
            authDomain: "mbtechstore-17984.firebaseapp.com",
            projectId: "mbtechstore-17984",
            storageBucket: "mbtechstore-17984.firebasestorage.app",
            messagingSenderId: "1083008774596",
            appId: "1:1083008774596:web:110b651c6426116ed43491"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'mbtech-public-store';

        // --- CRYPTO HELPER ---
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // --- COMPONENTS ---
        function AnimatedCounter({ target, suffix = '' }) {
            const [count, setCount] = useState(0);
            
            useEffect(() => {
                let start = 0;
                if (target === 0) return;
                
                const duration = 1500; 
                const interval = Math.max(30, duration / target);
                
                const timer = setInterval(() => {
                    start += 1;
                    setCount(start);
                    if (start >= target) clearInterval(timer);
                }, interval);
                
                return () => clearInterval(timer);
            }, [target]);

            return <span>{count}{suffix}</span>;
        }

        function Toast({ message, type, onClose }) {
            useEffect(() => { const timer = setTimeout(onClose, 3500); return () => clearTimeout(timer); }, [onClose]);
            const bgClass = type === 'success' ? 'bg-emerald-500' : type === 'error' ? 'bg-red-500' : 'bg-slate-800';
            return (
                <div className="fixed bottom-6 right-6 z-[80] animate-[slideUp_0.3s_ease-out]">
                    <div className={bgClass + " text-white px-6 py-3 rounded-xl shadow-lg flex items-center gap-3 font-bold"}>
                        {type === 'success' ? <Check size={18}/> : type === 'error' ? <ShieldAlert size={18}/> : <Info size={18}/>}
                        {message}
                    </div>
                </div>
            );
        }

        function Modal({ isOpen, onClose, title, children, maxWidth = "max-w-xl" }) {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay bg-slate-900/60 backdrop-blur-sm">
                    <div className={"bg-white rounded-2xl shadow-xl w-full max-h-[90vh] flex flex-col modal-content " + maxWidth}>
                        <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50 rounded-t-2xl">
                            <h3 className="text-lg font-bold text-slate-800">{title}</h3>
                            <button type="button" onClick={onClose} className="text-slate-400 hover:text-slate-600 transition-colors p-1 rounded-lg hover:bg-slate-200">
                                <Close size={20} />
                            </button>
                        </div>
                        <div className="p-6 overflow-y-auto hide-scrollbar flex-1">
                            {children}
                        </div>
                    </div>
                </div>
            );
        }

        function GlobalFooter() {
            return (
                <footer className="bg-slate-900 text-white pt-16 pb-8 mt-auto w-full z-10 border-t border-slate-800">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-1 md:grid-cols-4 gap-8 mb-12">
                        <div>
                            <img src="logo.png" alt="MBTECH Logo" className="h-10 mb-4 object-contain" onError={(e)=>{e.target.style.display='none'}}/>
                            <p className="text-slate-400 mb-4 text-sm leading-relaxed">
                                Empowering Africa through innovative technology solutions, digital skills training, and sustainable energy.
                            </p>
                            <div className="flex space-x-4">
                                <a href="https://facebook.com/mbtech.ng" target="_blank" rel="noopener noreferrer" className="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-slate-400 hover:bg-brand-500 hover:text-white transition-colors">f</a>
                                <a href="https://x.com/mbtech_ng" target="_blank" rel="noopener noreferrer" className="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-slate-400 hover:bg-brand-500 hover:text-white transition-colors">ùïè</a>
                                <a href="https://linkedin.com/company/mbtech-ng" target="_blank" rel="noopener noreferrer" className="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-slate-400 hover:bg-brand-500 hover:text-white transition-colors">in</a>
                            </div>
                        </div>
                        <div>
                            <h4 className="text-lg font-bold mb-4 text-white">Quick Links</h4>
                            <ul className="space-y-2 text-sm text-slate-400">
                                <li><a href="index.html" className="hover:text-brand-500 transition-colors">Home</a></li>
                                <li><a href="course.html" className="hover:text-brand-500 transition-colors">Academy</a></li>
                                <li><a href="store.html" className="hover:text-brand-500 transition-colors">Tech Store</a></li>
                                <li><a href="info.html" className="hover:text-brand-500 transition-colors">Updates & Info</a></li>
                                <li><a href="connect.html" className="hover:text-brand-500 transition-colors">Connect Platform</a></li>
                            </ul>
                        </div>
                        <div>
                            <h4 className="text-lg font-bold mb-4 text-white">Our Services</h4>
                            <ul className="space-y-2 text-sm text-slate-400">
                                <li><span className="hover:text-brand-500 transition-colors cursor-default">Digital Skills Training</span></li>
                                <li><span className="hover:text-brand-500 transition-colors cursor-default">Software Development</span></li>
                                <li><span className="hover:text-brand-500 transition-colors cursor-default">Solar Installation</span></li>
                                <li><span className="hover:text-brand-500 transition-colors cursor-default">Tech Consultancy</span></li>
                            </ul>
                        </div>
                        <div>
                            <h4 className="text-lg font-bold mb-4 text-white">Contact Us</h4>
                            <ul className="space-y-4 text-sm text-slate-400">
                                <li className="flex items-start">
                                    <span className="mr-3 mt-0.5 text-brand-500"><Location size={16} /></span>
                                    <span>Lagos, Nigeria</span>
                                </li>
                                <li className="flex items-center">
                                    <span className="mr-3 text-brand-500"><Phone size={16} /></span>
                                    <span>+234 708 467 2771</span>
                                </li>
                                <li className="flex items-center">
                                    <span className="mr-3 text-brand-500"><Mail size={16} /></span>
                                    <a href="mailto:mesobest.technology.org@gmail.com" className="hover:text-brand-500 transition-colors">support@mbtech.ng</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 border-t border-slate-800 pt-8 text-center text-slate-500 text-sm font-medium">
                        <p>&copy; {new Date().getFullYear()} Mesobest Technology. All rights reserved. | Secured Workspace</p>
                    </div>
                </footer>
            );
        }

        // --- MAIN APP COMPONENT ---
        function App() {
            const [hasAdminAccess, setHasAdminAccess] = useState(false);
            const [showLoginForm, setShowLoginForm] = useState(false);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [authError, setAuthError] = useState('');
            const [activeTab, setActiveTab] = useState('dashboard');
            const [toast, setToast] = useState(null);
            
            // Data State
            const [data, setData] = useState({ courses: [], store: [], info: [], connect: [], events: [] });
            const [syncProgress, setSyncProgress] = useState(0);
            const [isSyncing, setIsSyncing] = useState(true);
            const [isAuthenticating, setIsAuthenticating] = useState(false);
            
            // Modal States
            const [currentItem, setCurrentItem] = useState(null);
            const [isCourseModalOpen, setCourseModalOpen] = useState(false);
            const [isStoreModalOpen, setStoreModalOpen] = useState(false);
            const [isEventModalOpen, setEventModalOpen] = useState(false);
            const [isInfoModalOpen, setInfoModalOpen] = useState(false);
            const [isSettingsModalOpen, setSettingsModalOpen] = useState(false);

            // Connect Anonymously to allow public reading of stats
            useEffect(() => {
                signInAnonymously(auth).catch(e => console.warn("Background auth error:", e));
            }, []);

            // Fetch Realtime Data from Firestore
            useEffect(() => {
                const unsubscribes = [];
                let loadedCount = 0;
                const totalCollections = 5;

                const getCollectionPath = (tab) => {
                    const map = {
                        'store': 'mbtech_products',
                        'events': 'mbtech_events',
                        'info': 'mbtech_updates',
                        'courses': 'mbtech_courses',
                        'connect': 'mbtech_connect_leads'
                    };
                    return map[tab];
                };

                const tabs = ['store', 'events', 'info', 'courses', 'connect'];
                
                tabs.forEach(tab => {
                    const colPath = getCollectionPath(tab);
                    const q = collection(db, 'artifacts', appId, 'public', 'data', colPath);
                    
                    const unsub = onSnapshot(q, (snapshot) => {
                        const arr = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        arr.sort((a,b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                        setData(prev => ({ ...prev, [tab]: arr }));
                        
                        if (loadedCount < totalCollections) {
                            loadedCount++;
                            setSyncProgress(Math.floor((loadedCount / totalCollections) * 100));
                            if (loadedCount === totalCollections) setIsSyncing(false);
                        }
                    }, (error) => {
                        console.warn(`Error loading ${tab}:`, error);
                        if (loadedCount < totalCollections) {
                            loadedCount++;
                            setSyncProgress(Math.floor((loadedCount / totalCollections) * 100));
                            if (loadedCount === totalCollections) setIsSyncing(false);
                        }
                    });
                    unsubscribes.push(unsub);
                });

                const timeoutId = setTimeout(() => { setIsSyncing(false); setSyncProgress(100); }, 8000);

                return () => {
                    unsubscribes.forEach(u => u());
                    clearTimeout(timeoutId);
                };
            }, []);

            // Google Login specific to Admin Email
            const handleGoogleLogin = async () => {
                setIsAuthenticating(true);
                setAuthError(''); // Clear previous errors
                try {
                    const provider = new GoogleAuthProvider();
                    provider.setCustomParameters({ prompt: 'select_account' }); // Force account selection
                    const result = await signInWithPopup(auth, provider);
                    
                    // Allow the exact requested email address (including the potential typo version provided)
                    const allowedEmails = ['emmanuel.amobi03@gmail.com', 'emmanuel.amobi03@gmai.com', 'mesobest2000@gmail.com'];
                    
                    if (result.user.email && allowedEmails.includes(result.user.email.toLowerCase())) {
                        setHasAdminAccess(true);
                        setShowLoginForm(false);
                        setAuthError('');
                    } else {
                        setAuthError(`Unauthorized Account (${result.user.email}). You do not have admin privileges.`);
                        await auth.signOut();
                        await signInAnonymously(auth); // Re-establish public connection
                    }
                } catch (err) {
                    console.error("Google Auth Error Object:", err);
                    
                    // Detailed Error Handling for better debugging
                    if (err.code === 'auth/unauthorized-domain') {
                        setAuthError('Error: This domain is not authorized. Add it in Firebase Console -> Auth -> Settings -> Authorized domains.');
                    } else if (err.code === 'auth/operation-not-supported-in-this-environment') {
                        setAuthError('Error: Cannot run Google Login on file://. Please use a local web server (like VS Code Live Server).');
                    } else if (err.code === 'auth/popup-closed-by-user') {
                        setAuthError('Sign-in cancelled. The popup was closed before finishing.');
                    } else if (err.code === 'auth/popup-blocked') {
                         setAuthError('Error: Popup blocked by browser. Please allow popups for this site.');
                    } else {
                        setAuthError(err.message.replace('Firebase: ', ''));
                    }
                }
                setIsAuthenticating(false);
            };

            // Email and Password Login
            const handleEmailLogin = async (e) => {
                e.preventDefault();
                setIsAuthenticating(true);
                setAuthError('');
                
                try {
                    const result = await signInWithEmailAndPassword(auth, email, password);
                    const allowedEmails = ['emmanuel.amobi03@gmail.com', 'emmanuel.amobi03@gmai.com', 'mesobest2000@gmail.com'];
                    
                    if (result.user.email && allowedEmails.includes(result.user.email.toLowerCase())) {
                        setHasAdminAccess(true);
                        setShowLoginForm(false);
                        setAuthError('');
                    } else {
                        setAuthError(`Unauthorized Account (${result.user.email}). You do not have admin privileges.`);
                        await auth.signOut();
                        await signInAnonymously(auth); // Re-establish public connection
                    }
                } catch (err) {
                    console.error("Email Auth Error:", err);
                    if (err.code === 'auth/invalid-credential' || err.code === 'auth/wrong-password' || err.code === 'auth/user-not-found') {
                        setAuthError('Invalid email or password.');
                    } else {
                        setAuthError(err.message.replace('Firebase: ', ''));
                    }
                }
                setIsAuthenticating(false);
            };

            const handleLogout = () => { 
                setHasAdminAccess(false); 
                setShowLoginForm(false); 
                setEmail(''); 
                setPassword(''); 
            };

            const showToast = (message, type = 'success') => setToast({ message, type });

            // Universal CRUD Handler mapped to Firestore Collections
            const handleSave = async (e, tabName, setModalOpen, extraData = {}) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const payload = Object.fromEntries(formData.entries());
                Object.assign(payload, extraData);
                
                if (payload.price) payload.price = parseFloat(payload.price);
                if (payload.oldPrice) payload.oldPrice = parseFloat(payload.oldPrice);
                if (payload.stock) payload.stock = parseInt(payload.stock);

                if (tabName === 'courses' && payload.curriculumRaw) {
                    payload.curriculum = payload.curriculumRaw.split('\n').map(s => s.trim()).filter(s => s);
                    delete payload.curriculumRaw;
                }

                const map = {
                    'store': 'mbtech_products',
                    'events': 'mbtech_events',
                    'info': 'mbtech_updates',
                    'courses': 'mbtech_courses'
                };
                const colPath = map[tabName];

                try {
                    if (currentItem && currentItem.id) {
                        const docRef = doc(db, 'artifacts', appId, 'public', 'data', colPath, currentItem.id);
                        await updateDoc(docRef, payload);
                        showToast(tabName.charAt(0).toUpperCase() + tabName.slice(1) + ' successfully updated!');
                    } else {
                        payload.createdAt = serverTimestamp();
                        await addDoc(collection(db, 'artifacts', appId, 'public', 'data', colPath), payload);
                        showToast('New item added to ' + tabName + '!');
                    }
                    setModalOpen(false);
                    setCurrentItem(null);
                } catch (error) {
                    showToast(error.message, 'error');
                }
            };

            const handleDelete = async (tabName, id) => {
                if (window.confirm('Are you sure you want to permanently delete this item?')) {
                    const map = {
                        'store': 'mbtech_products',
                        'events': 'mbtech_events',
                        'info': 'mbtech_updates',
                        'courses': 'mbtech_courses',
                        'connect': 'mbtech_connect_leads'
                    };
                    try {
                        await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', map[tabName], id));
                        showToast('Item deleted successfully.');
                    } catch (error) {
                        showToast(error.message, 'error');
                    }
                }
            };

            const openModal = (item, setModalOpen) => {
                setCurrentItem(item);
                setModalOpen(true);
            };

            const ProgressBar = () => {
                if (!isSyncing) return null;
                return (
                    <div className="w-full bg-slate-100 h-1 overflow-hidden z-40 relative">
                        <div className="bg-brand-500 h-full transition-all duration-300 ease-out" style={{ width: syncProgress + '%' }}></div>
                    </div>
                );
            };

            const activeEventsCount = data.events.filter(e => e.status === 'Active').length;
            const dashboardStats = [
                { label: 'Products in Store', val: data.store.length, icon: StoreIcon, color: 'text-emerald-600', bg: 'bg-emerald-50' },
                { label: 'Blog Updates', val: data.info.length, icon: Info, color: 'text-purple-600', bg: 'bg-purple-50' },
                { label: 'Active Events', val: activeEventsCount, icon: Event, color: 'text-blue-600', bg: 'bg-blue-50' },
                { label: 'Academy Courses', val: data.courses.length, icon: Course, color: 'text-amber-600', bg: 'bg-amber-50' },
            ];

            // --- VIEW 1: PUBLIC WEBSITE OVERVIEW ---
            if (!hasAdminAccess && !showLoginForm) {
                return (
                    <div className="flex-1 flex flex-col bg-slate-50 min-h-screen font-sans">
                        <nav className="bg-white border-b border-slate-200 sticky top-0 z-30 shadow-sm">
                            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                <div className="flex justify-between h-16 items-center">
                                    <div className="flex items-center gap-3">
                                        <img src="logo.png" alt="MBTECH" className="h-8 w-auto object-contain" onError={(e)=>{e.target.style.display='none'}}/>
                                        <span className="text-lg font-bold text-slate-900 hidden sm:block border-l border-slate-300 pl-3">Website Overview</span>
                                    </div>
                                    <button onClick={() => setShowLoginForm(true)} className="px-5 py-2.5 bg-brand-600 hover:bg-brand-700 text-white rounded-xl font-bold text-sm transition-colors shadow-sm flex items-center gap-2">
                                        <Lock size={16}/> <span>Login as Admin</span>
                                    </button>
                                </div>
                            </div>
                        </nav>
                        <ProgressBar />
                        <main className="flex-1 w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
                             <div className="text-center mb-12">
                                 <h1 className="text-3xl sm:text-4xl font-extrabold text-slate-900 mb-4 tracking-tight">MBTECH System Overview</h1>
                                 <p className="text-slate-600 max-w-2xl mx-auto text-lg leading-relaxed">Public analytics dashboard. Log in as an administrator to manage the store inventory, publish blog posts, configure events, and review user inquiries.</p>
                             </div>

                             <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                 {dashboardStats.map((stat, i) => (
                                     <div key={i} className="bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm flex flex-col items-center text-center gap-4 hover:shadow-xl transition-all">
                                         <div className={"w-16 h-16 rounded-2xl flex items-center justify-center " + stat.bg + " " + stat.color}>
                                             <stat.icon size={28}/>
                                         </div>
                                         <div>
                                             <p className="text-4xl font-extrabold text-slate-800 mb-1">
                                                 {isSyncing && stat.val === 0 ? <span className="text-2xl text-slate-400 animate-pulse">...</span> : <AnimatedCounter target={stat.val} />}
                                             </p>
                                             <p className="text-slate-500 font-bold uppercase tracking-wider text-xs mt-2">{stat.label}</p>
                                         </div>
                                     </div>
                                 ))}
                             </div>
                        </main>
                        <GlobalFooter />
                    </div>
                );
            }

            // --- VIEW 2: LOGIN PASSCODE SCREEN ---
            if (!hasAdminAccess && showLoginForm) {
                return (
                    <div className="flex-1 flex flex-col justify-between font-sans">
                        <div className="flex-1 flex items-center justify-center p-4 py-20 bg-slate-50">
                            <div className="bg-white p-8 rounded-[2rem] shadow-xl w-full max-w-md border border-slate-100 relative">
                                <div className="text-center mb-8">
                                    <div className="w-16 h-16 bg-brand-50 text-brand-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                        <Lock size={32}/>
                                    </div>
                                    <h1 className="text-2xl font-extrabold text-slate-900 mb-2">Workspace Access</h1>
                                    <p className="text-slate-500 text-sm">Sign in securely to manage the platform.</p>
                                </div>
                                
                                <button onClick={handleGoogleLogin} disabled={isAuthenticating} className="w-full flex items-center justify-center gap-3 py-3.5 px-4 border border-slate-200 rounded-xl hover:bg-slate-50 transition-colors font-bold text-slate-700 mb-5 disabled:opacity-50">
                                    <svg className="w-5 h-5" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                                    Sign in with Admin Email
                                </button>

                                <div className="flex items-center gap-3 mb-5">
                                    <div className="h-px bg-slate-200 flex-1"></div>
                                    <span className="text-xs text-slate-400 font-bold uppercase tracking-wider">Or use email & password</span>
                                    <div className="h-px bg-slate-200 flex-1"></div>
                                </div>

                                <form onSubmit={handleEmailLogin} className="space-y-4">
                                    <div>
                                        <input 
                                            type="email" 
                                            value={email} 
                                            onChange={(e) => setEmail(e.target.value)}
                                            placeholder="Admin Email" 
                                            className="w-full px-4 py-3.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none text-slate-800 transition-all font-medium"
                                            required
                                        />
                                    </div>
                                    <div className="mb-6">
                                        <input 
                                            type="password" 
                                            value={password} 
                                            onChange={(e) => setPassword(e.target.value)}
                                            placeholder="Password" 
                                            className="w-full px-4 py-3.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none text-slate-800 transition-all font-medium tracking-wide"
                                            required
                                        />
                                    </div>
                                    {authError && <div className="p-3 bg-red-50 text-red-600 rounded-xl text-sm font-medium flex items-start gap-2 border border-red-100"><ShieldAlert size={18} className="shrink-0 mt-0.5"/>{authError}</div>}
                                    <button type="submit" disabled={isAuthenticating} className="w-full py-4 px-4 bg-brand-600 hover:bg-brand-700 text-white rounded-xl font-bold shadow-lg shadow-brand-500/20 transition-all hover:-translate-y-0.5 flex items-center justify-center gap-2">
                                        {isAuthenticating ? <Loader2 className="animate-spin" size={20}/> : <span>Unlock Workspace</span>}
                                    </button>
                                </form>
                                <div className="mt-8 text-center border-t border-slate-100 pt-6">
                                    <button type="button" onClick={() => setShowLoginForm(false)} className="text-sm font-bold text-slate-500 hover:text-slate-800 transition-colors">
                                        &larr; Return to Overview
                                    </button>
                                </div>
                            </div>
                        </div>
                        <GlobalFooter />
                    </div>
                );
            }

            // --- VIEW 3: ADMIN DASHBOARD (Authenticated) ---
            const navItems = [
                { id: 'dashboard', label: 'Dashboard', icon: LayoutDashboard },
                { id: 'store', label: 'Store Inventory', icon: StoreIcon },
                { id: 'events', label: 'Events Mgt', icon: Event },
                { id: 'info', label: 'Blog & News', icon: Info },
                { id: 'courses', label: 'Academy', icon: Course },
                { id: 'connect', label: 'Users & Leads', icon: Users },
            ];

            return (
                <div className="flex-1 flex flex-col font-sans">
                    {/* Top Navigation */}
                    <nav className="bg-white border-b border-slate-200 sticky top-0 z-30 shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between h-16">
                                <div className="flex overflow-hidden">
                                    <div className="flex-shrink-0 flex items-center gap-3 mr-8">
                                        <img src="logo.png" alt="MBTECH" className="h-8 w-auto object-contain" onError={(e)=>{e.target.style.display='none'}}/>
                                        <span className="text-lg font-bold text-slate-900 hidden sm:block border-l border-slate-300 pl-3">Workspace</span>
                                    </div>
                                    
                                    {/* Desktop Tabs */}
                                    <div className="hidden lg:flex space-x-6">
                                        {navItems.map(item => (
                                            <button 
                                                key={item.id} 
                                                onClick={() => setActiveTab(item.id)}
                                                className={"whitespace-nowrap py-4 px-1 border-b-[3px] font-bold text-sm flex items-center transition-colors " + (activeTab === item.id ? 'border-brand-600 text-brand-600' : 'border-transparent text-slate-500 hover:text-slate-800 hover:border-slate-300')}
                                            >
                                                <item.icon size={16} />
                                                <span className="ml-2">{item.label}</span>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div className="flex items-center space-x-3">
                                    <button onClick={() => setSettingsModalOpen(true)} className="text-slate-400 hover:text-slate-700 p-2 rounded-full hover:bg-slate-100 transition-colors" title="Settings">
                                        <Settings size={20}/>
                                    </button>
                                    <button onClick={handleLogout} className="text-slate-400 hover:text-red-500 p-2 rounded-full hover:bg-red-50 transition-colors" title="Logout">
                                        <LogOut size={20}/>
                                    </button>
                                </div>
                            </div>
                        </div>
                        {/* Mobile Tabs */}
                        <div className="lg:hidden border-t border-slate-100 bg-slate-50 px-2 py-2 flex overflow-x-auto hide-scrollbar space-x-2 snap-x">
                             {navItems.map(item => (
                                <button 
                                    key={item.id} 
                                    onClick={() => setActiveTab(item.id)}
                                    className={"snap-start whitespace-nowrap px-4 py-2.5 rounded-xl text-sm font-bold flex items-center transition-colors " + (activeTab === item.id ? 'bg-brand-100 text-brand-700 border border-brand-200' : 'text-slate-600 hover:bg-slate-200')}
                                >
                                    <item.icon size={16}/>
                                    <span className="ml-2">{item.label}</span>
                                </button>
                            ))}
                        </div>
                    </nav>
                    <ProgressBar />

                    {/* Main Content Area */}
                    <main className="flex-1 w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {isSyncing && (
                            <div className="mb-6 flex items-center justify-between bg-brand-50 text-brand-700 px-4 py-3 rounded-xl text-sm font-bold border border-brand-100 shadow-sm">
                                <div className="flex items-center gap-3">
                                    <Sync size={16} className="animate-spin" />
                                    <span>Live syncing with Firestore Database...</span>
                                </div>
                                <span>{syncProgress}%</span>
                            </div>
                        )}
                        
                        {/* DASHBOARD */}
                        {activeTab === 'dashboard' && (
                            <div className="space-y-6 animate-in fade-in">
                                <h2 className="text-3xl font-extrabold text-slate-900">System Dashboard</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                    {dashboardStats.map((stat, i) => (
                                        <div key={i} className="bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm flex items-center gap-5 hover:shadow-md transition-shadow">
                                            <div className={"w-14 h-14 rounded-xl flex items-center justify-center " + stat.bg + " " + stat.color}>
                                                <stat.icon size={24}/>
                                            </div>
                                            <div>
                                                <p className="text-slate-500 text-xs font-bold uppercase tracking-wider mb-1">{stat.label}</p>
                                                <p className="text-3xl font-extrabold text-slate-800">
                                                    {isSyncing && stat.val === 0 ? <span className="text-xl text-slate-400 animate-pulse">...</span> : <span>{stat.val}</span>}
                                                </p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                
                                <div className="mt-12 bg-white rounded-[2rem] border border-slate-200 p-8 text-center shadow-sm">
                                    <h3 className="text-xl font-bold text-slate-900 mb-2">Welcome to your connected Workspace</h3>
                                    <p className="text-slate-500">Select a tab above to manage your Store, Courses, News Updates, and view user leads generated from your platform.</p>
                                </div>
                            </div>
                        )}

                        {/* STORE TAB */}
                        {activeTab === 'store' && (
                            <div className="animate-in fade-in">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-extrabold text-slate-900">Store Inventory</h2>
                                    <button onClick={() => openModal(null, setStoreModalOpen)} className="bg-brand-600 hover:bg-brand-700 text-white px-5 py-2.5 rounded-xl font-bold flex items-center shadow-sm transition-all hover:-translate-y-0.5">
                                        <Plus size={18}/> <span className="ml-2">Add Item</span>
                                    </button>
                                </div>
                                <div className="bg-white rounded-[2rem] border border-slate-200 shadow-sm overflow-hidden w-full">
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-left border-collapse min-w-[800px]">
                                            <thead>
                                                <tr className="bg-slate-50 text-slate-500 text-xs uppercase tracking-wider border-b border-slate-200">
                                                    <th className="p-5 font-bold">Product</th>
                                                    <th className="p-5 font-bold">Category</th>
                                                    <th className="p-5 font-bold">Type</th>
                                                    <th className="p-5 font-bold">Price (‚Ç¶)</th>
                                                    <th className="p-5 font-bold text-right">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-100">
                                                {data.store.map(item => (
                                                    <tr key={item.id} className="hover:bg-slate-50 transition-colors">
                                                        <td className="p-5 flex items-center gap-4 min-w-[250px]">
                                                            <img src={item.image} alt="" className="w-12 h-12 rounded-xl object-cover bg-slate-100 border border-slate-200 flex-shrink-0" onError={(e) => { e.target.src='https://placehold.co/100?text=IMG' }} />
                                                            <div>
                                                                <span className="font-bold text-slate-800 line-clamp-1">{item.name}</span>
                                                                {item.featured && <span className="text-[9px] bg-amber-100 text-amber-800 px-2 py-0.5 rounded font-bold uppercase">Featured</span>}
                                                            </div>
                                                        </td>
                                                        <td className="p-5 text-sm text-slate-600 whitespace-nowrap font-medium">{item.category}</td>
                                                        <td className="p-5 whitespace-nowrap">
                                                            <span className={"text-[10px] font-bold uppercase tracking-wider px-3 py-1.5 rounded-lg " + (item.type === 'service' ? 'bg-purple-50 text-purple-700' : 'bg-blue-50 text-blue-700')}>
                                                                {item.type === 'service' ? 'Service' : 'Good'}
                                                            </span>
                                                        </td>
                                                        <td className="p-5 text-base font-extrabold text-slate-800 whitespace-nowrap">{(item.price || 0).toLocaleString()}</td>
                                                        <td className="p-5 text-right whitespace-nowrap">
                                                            <div className="flex justify-end gap-2">
                                                                <button onClick={() => openModal(item, setStoreModalOpen)} className="p-2 text-slate-400 hover:text-brand-600 bg-white border border-slate-200 hover:border-brand-200 rounded-lg shadow-sm"><Edit size={16}/></button>
                                                                <button onClick={() => handleDelete('store', item.id)} className="p-2 text-slate-400 hover:text-red-600 bg-white border border-slate-200 hover:border-red-200 rounded-lg shadow-sm"><Delete size={16}/></button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                        {data.store.length === 0 && (
                                            <div className="p-16 text-center text-slate-500 font-medium">
                                                {isSyncing ? <span>Syncing data from Firestore...</span> : <span>Store is empty. Add your first product.</span>}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* EVENTS TAB */}
                        {activeTab === 'events' && (
                            <div className="animate-in fade-in">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-extrabold text-slate-900">Events Management</h2>
                                    <button onClick={() => openModal(null, setEventModalOpen)} className="bg-brand-600 hover:bg-brand-700 text-white px-5 py-2.5 rounded-xl font-bold flex items-center shadow-sm transition-all hover:-translate-y-0.5">
                                        <Plus size={18}/> <span className="ml-2">Create Event</span>
                                    </button>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {data.events.map(event => (
                                        <div key={event.id} className="bg-white rounded-[2rem] border border-slate-200 shadow-sm overflow-hidden flex flex-col group hover:shadow-xl transition-all">
                                            <div className="h-48 bg-slate-900 relative overflow-hidden">
                                                <img src={event.image || 'https://placehold.co/600x400?text=Event'} className="w-full h-full object-cover opacity-90 group-hover:scale-105 transition-transform duration-500" />
                                                <div className={"absolute top-4 right-4 px-3 py-1.5 rounded-lg text-[10px] uppercase tracking-widest font-extrabold shadow-sm " + (event.status === 'Active' ? 'bg-white/90 backdrop-blur text-brand-dark' : event.status === 'Cancelled' ? 'bg-red-600 text-white' : 'bg-slate-800 text-white')}>
                                                    {event.status || 'Active'}
                                                </div>
                                            </div>
                                            <div className="p-6 flex-1 flex flex-col">
                                                <h3 className="font-extrabold text-xl text-slate-900 leading-tight mb-2">{event.title}</h3>
                                                <p className="text-sm text-brand-600 font-bold mb-4">{event.date} &#8226; {event.time}</p>
                                                <p className="text-sm text-slate-500 line-clamp-3 mb-6 flex-1 leading-relaxed">{event.description}</p>
                                                <div className="flex items-center justify-between pt-4 border-t border-slate-100">
                                                    <span className="text-xs font-bold text-slate-500 uppercase tracking-wider truncate max-w-[150px] flex items-center gap-1.5">
                                                        <Location size={14} className="text-brand-orange"/> {event.location}
                                                    </span>
                                                    <div className="flex gap-2 flex-shrink-0">
                                                        <button onClick={() => openModal(event, setEventModalOpen)} className="p-2.5 text-slate-400 hover:text-brand-600 bg-slate-50 hover:bg-brand-50 rounded-xl transition-colors"><Edit size={16}/></button>
                                                        <button onClick={() => handleDelete('events', event.id)} className="p-2.5 text-slate-400 hover:text-red-600 bg-slate-50 hover:bg-red-50 rounded-xl transition-colors"><Delete size={16}/></button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                    {data.events.length === 0 && (
                                        <div className="col-span-full py-16 text-center text-slate-400 bg-white rounded-[2rem] border border-slate-200 border-dashed">
                                            {isSyncing ? <span>Syncing data...</span> : <span>No events found. Create one above.</span>}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* INFO/BLOG TAB */}
                        {activeTab === 'info' && (
                            <div className="animate-in fade-in">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-extrabold text-slate-900">Blog & News</h2>
                                    <button onClick={() => openModal(null, setInfoModalOpen)} className="bg-brand-600 hover:bg-brand-700 text-white px-5 py-2.5 rounded-xl font-bold flex items-center shadow-sm transition-all hover:-translate-y-0.5">
                                        <Plus size={18}/> <span className="ml-2">Write Post</span>
                                    </button>
                                </div>
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    {data.info.map(post => (
                                        <div key={post.id} className="bg-white rounded-[2rem] border border-slate-200 shadow-sm p-6 flex flex-col sm:flex-row gap-6 hover:shadow-lg transition-all group">
                                            <div className="w-full sm:w-40 h-48 sm:h-36 rounded-xl bg-slate-100 flex-shrink-0 overflow-hidden relative">
                                                <img src={post.image || 'https://placehold.co/400?text=News'} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" alt="" />
                                                {!post.published && <div className="absolute inset-0 bg-slate-900/60 flex items-center justify-center text-white text-xs font-bold tracking-wider">DRAFT</div>}
                                            </div>
                                            <div className="flex-1 flex flex-col justify-between">
                                                <div>
                                                    <div className="flex gap-2 mb-3">
                                                        <span className="text-[10px] font-extrabold uppercase tracking-widest text-brand-700 bg-brand-50 px-2.5 py-1 rounded-md">{post.category}</span>
                                                        <span className="text-[10px] font-bold uppercase tracking-widest text-slate-400 border border-slate-100 px-2.5 py-1 rounded-md">{post.date}</span>
                                                    </div>
                                                    <h3 className="font-extrabold text-slate-900 text-lg leading-tight mb-2 group-hover:text-brand-600 transition-colors">{post.title}</h3>
                                                    <p className="text-sm text-slate-500 line-clamp-2 leading-relaxed">{post.excerpt}</p>
                                                </div>
                                                <div className="flex justify-end gap-2 mt-4 pt-4 border-t border-slate-100/60">
                                                    <button onClick={() => openModal(post, setInfoModalOpen)} className="text-xs font-bold text-slate-600 hover:text-brand-700 px-4 py-2 bg-slate-50 hover:bg-brand-50 rounded-lg transition-colors">Edit Article</button>
                                                    <button onClick={() => handleDelete('info', post.id)} className="text-xs font-bold text-red-500 hover:text-white px-4 py-2 bg-red-50 hover:bg-red-500 rounded-lg transition-colors">Delete</button>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                    {data.info.length === 0 && (
                                        <div className="col-span-full py-16 text-center text-slate-500 bg-white rounded-[2rem] border border-slate-200 border-dashed">
                                            {isSyncing ? <span>Syncing data...</span> : <span>No articles published yet.</span>}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* COURSES TAB */}
                        {activeTab === 'courses' && (
                            <div className="animate-in fade-in">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-extrabold text-slate-900">Academy Programs</h2>
                                    <button onClick={() => openModal(null, setCourseModalOpen)} className="bg-brand-600 hover:bg-brand-700 text-white px-5 py-2.5 rounded-xl font-bold flex items-center shadow-sm transition-all hover:-translate-y-0.5">
                                        <Plus size={18}/> <span className="ml-2">Add Course</span>
                                    </button>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {data.courses.map(course => (
                                        <div key={course.id} className="bg-white rounded-[2rem] border border-slate-200 shadow-sm overflow-hidden flex flex-col group hover:shadow-xl transition-all">
                                            <div className="h-48 bg-slate-100 relative overflow-hidden">
                                                <img src={course.image || 'https://placehold.co/600x400?text=No+Image'} alt={course.title} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
                                                <div className="absolute inset-0 bg-gradient-to-t from-slate-900/80 to-transparent"></div>
                                                <div className="absolute top-4 right-4 bg-white/90 backdrop-blur-sm px-3 py-1.5 rounded-lg text-xs font-extrabold text-slate-900 shadow-sm">
                                                    ‚Ç¶{(course.price||0).toLocaleString()}
                                                </div>
                                                <div className="absolute bottom-4 left-4">
                                                    <span className="text-[10px] font-bold uppercase tracking-widest text-white bg-brand-orange px-3 py-1.5 rounded-full">{course.category}</span>
                                                </div>
                                            </div>
                                            <div className="p-6 flex-1 flex flex-col">
                                                <h3 className="font-extrabold text-lg text-slate-900 leading-tight mb-2">{course.title}</h3>
                                                <p className="text-sm text-slate-500 line-clamp-2 mb-4 flex-1 leading-relaxed">{course.description}</p>
                                                <div className="flex items-center justify-between pt-4 border-t border-slate-100">
                                                    <span className={"text-[10px] font-bold uppercase tracking-widest px-3 py-1.5 rounded-lg " + (course.published !== false ? 'bg-emerald-50 text-emerald-600' : 'bg-slate-100 text-slate-500')}>{course.published !== false ? 'Active' : 'Hidden'}</span>
                                                    <div className="flex gap-2">
                                                        <button onClick={() => openModal(course, setCourseModalOpen)} className="p-2.5 text-slate-400 hover:text-brand-600 bg-slate-50 hover:bg-brand-50 rounded-xl transition-colors"><Edit size={16}/></button>
                                                        <button onClick={() => handleDelete('courses', course.id)} className="p-2.5 text-slate-400 hover:text-red-600 bg-slate-50 hover:bg-red-50 rounded-xl transition-colors"><Delete size={16}/></button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                    {data.courses.length === 0 && (
                                        <div className="col-span-full py-16 text-center text-slate-400 bg-white rounded-[2rem] border border-slate-200 border-dashed">
                                            {isSyncing ? <span>Syncing courses from database...</span> : <span>No courses found. Add one above.</span>}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* CONNECT (USERS & LEADS) TAB */}
                        {activeTab === 'connect' && (
                            <div className="animate-in fade-in">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-extrabold text-slate-900">User Inquiries & Leads</h2>
                                </div>
                                <div className="bg-white rounded-[2rem] border border-slate-200 shadow-sm overflow-hidden w-full">
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-left border-collapse min-w-[800px]">
                                            <thead>
                                                <tr className="bg-slate-50 text-slate-500 text-xs uppercase tracking-wider border-b border-slate-200">
                                                    <th className="p-6 font-bold">Date</th>
                                                    <th className="p-6 font-bold">Contact Info</th>
                                                    <th className="p-6 font-bold">Status</th>
                                                    <th className="p-6 font-bold">Skill Interest</th>
                                                    <th className="p-6 font-bold text-right">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-100">
                                                {data.connect.map(lead => (
                                                    <tr key={lead.id} className="hover:bg-slate-50 transition-colors">
                                                        <td className="p-6 text-sm font-bold text-slate-500 whitespace-nowrap">{lead.createdAt?.seconds ? new Date(lead.createdAt.seconds * 1000).toLocaleDateString() : 'Recent'}</td>
                                                        <td className="p-6 min-w-[200px]">
                                                            <p className="font-extrabold text-slate-900">{lead.name}</p>
                                                            <p className="text-sm font-bold text-brand-600 hover:underline"><a href={"mailto:" + lead.email}>{lead.email}</a></p>
                                                            <p className="text-xs font-bold text-slate-400 mt-0.5">{lead.phone}</p>
                                                        </td>
                                                        <td className="p-6 text-sm font-bold text-slate-700">{lead.status}</td>
                                                        <td className="p-6">
                                                            <span className="text-[10px] font-extrabold uppercase tracking-wider bg-brand-50 text-brand-700 px-3 py-1.5 rounded-lg">{lead.skill}</span>
                                                        </td>
                                                        <td className="p-6 text-right whitespace-nowrap">
                                                            <button onClick={() => handleDelete('connect', lead.id)} className="p-2.5 text-slate-400 hover:text-red-600 bg-white border border-slate-200 hover:border-red-200 rounded-xl shadow-sm"><Delete size={16}/></button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                        {data.connect.length === 0 && (
                                            <div className="p-16 text-center text-slate-500 font-medium">
                                                {isSyncing ? <span>Syncing leads...</span> : <span>No connect leads captured yet.</span>}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    <GlobalFooter />

                    {/* MODALS FOR CRUD */}
                    
                    {/* Store Modal */}
                    <Modal isOpen={isStoreModalOpen} onClose={() => setStoreModalOpen(false)} title={currentItem ? "Edit Product/Service" : "Add to Store"}>
                        <form onSubmit={(e) => handleSave(e, 'store', setStoreModalOpen)} className="space-y-5">
                            <div>
                                <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Item Name</label>
                                <input name="name" required defaultValue={currentItem?.name} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all" />
                            </div>
                            <div className="grid grid-cols-2 gap-5">
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Category</label>
                                    <select name="category" defaultValue={currentItem?.category || 'Solar & Energy'} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all appearance-none">
                                        <option value="Solar & Energy">Solar & Energy</option>
                                        <option value="Gadgets">Gadgets</option>
                                        <option value="Electricals">Electricals</option>
                                        <option value="Software">Software</option>
                                        <option value="Services">Services</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Product Type</label>
                                    <select name="type" defaultValue={currentItem?.type || 'good'} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all appearance-none">
                                        <option value="good">Physical Good</option>
                                        <option value="service">Service / Installation</option>
                                    </select>
                                </div>
                            </div>
                            <div className="grid grid-cols-2 gap-5">
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Price (‚Ç¶)</label>
                                    <input name="price" type="number" required defaultValue={currentItem?.price} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all" />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Stock Quantity</label>
                                    <input name="stock" type="number" required defaultValue={currentItem?.stock || 10} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all" />
                                </div>
                            </div>
                            <div className="flex items-center gap-2 mb-2">
                                <input type="checkbox" name="featured" id="featured" defaultChecked={currentItem?.featured} className="w-4 h-4 text-brand-600 rounded" />
                                <label htmlFor="featured" className="text-sm font-bold text-slate-700">Feature this product on homepage</label>
                            </div>
                            <div>
                                <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Image URL</label>
                                <input name="image" type="url" required defaultValue={currentItem?.image} placeholder="https://..." className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all" />
                            </div>
                            <div className="pt-6 flex justify-end gap-3 border-t border-slate-100">
                                <button type="button" onClick={() => setStoreModalOpen(false)} className="px-5 py-3 text-slate-600 hover:text-slate-900 bg-white border border-slate-200 rounded-xl font-bold transition-colors">Cancel</button>
                                <button type="submit" className="px-6 py-3 text-white bg-brand-600 rounded-xl hover:bg-brand-700 font-bold shadow-lg shadow-brand-500/30 transition-all hover:-translate-y-0.5">Save Product</button>
                            </div>
                        </form>
                    </Modal>

                    {/* Events Modal */}
                    <Modal isOpen={isEventModalOpen} onClose={() => setEventModalOpen(false)} title={currentItem ? "Edit Event" : "Create Event"}>
                        <form onSubmit={(e) => handleSave(e, 'events', setEventModalOpen)} className="space-y-5">
                            <div>
                                <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Event Title</label>
                                <input name="title" required defaultValue={currentItem?.title} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all" />
                            </div>
                            <div className="grid grid-cols-2 gap-5">
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Date</label>
                                    <input name="date" type="date" required defaultValue={currentItem?.date} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all" />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Time</label>
                                    <input name="time" type="time" required defaultValue={currentItem?.time} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all" />
                                </div>
                            </div>
                            <div>
                                <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Location / Link</label>
                                <input name="location" required defaultValue={currentItem?.location} placeholder="e.g. Google Meet Link" className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all" />
                            </div>
                            <div>
                                <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Image URL</label>
                                <input name="image" type="url" required defaultValue={currentItem?.image} placeholder="https://..." className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all" />
                            </div>
                            <div>
                                <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Description</label>
                                <textarea name="description" required rows="3" defaultValue={currentItem?.description} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all resize-none"></textarea>
                            </div>
                            <div>
                                <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Status</label>
                                <select name="status" defaultValue={currentItem?.status || 'Active'} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all appearance-none">
                                    <option value="Active">Active</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Cancelled">Cancelled</option>
                                </select>
                            </div>
                            <div className="pt-6 flex justify-end gap-3 border-t border-slate-100">
                                <button type="button" onClick={() => setEventModalOpen(false)} className="px-5 py-3 text-slate-600 hover:text-slate-900 bg-white border border-slate-200 rounded-xl font-bold transition-colors">Cancel</button>
                                <button type="submit" className="px-6 py-3 text-white bg-brand-600 rounded-xl hover:bg-brand-700 font-bold shadow-lg shadow-brand-500/30 transition-all hover:-translate-y-0.5">Save Event</button>
                            </div>
                        </form>
                    </Modal>

                    {/* Info Modal */}
                    <Modal isOpen={isInfoModalOpen} onClose={() => setInfoModalOpen(false)} title={currentItem ? "Edit Blog Post" : "Write Blog Post"} maxWidth="max-w-2xl">
                        <form onSubmit={(e) => handleSave(e, 'info', setInfoModalOpen, { date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }), author: 'MBTECH Admin', published: e.target.status.value === 'Published' })} className="space-y-5">
                            <div className="grid grid-cols-2 gap-5">
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Post Title</label>
                                    <input name="title" required defaultValue={currentItem?.title} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all" />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Category</label>
                                    <input name="category" required defaultValue={currentItem?.category || 'Updates'} placeholder="e.g. Tech News" className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all" />
                                </div>
                            </div>
                            <div>
                                <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Cover Image URL</label>
                                <input name="image" type="url" required defaultValue={currentItem?.image} placeholder="https://..." className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all" />
                            </div>
                            <div>
                                <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Short Excerpt</label>
                                <textarea name="excerpt" required rows="2" defaultValue={currentItem?.excerpt} placeholder="A quick summary for homepage..." className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all resize-none"></textarea>
                            </div>
                            <div>
                                <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Full Content</label>
                                <textarea name="content" required rows="8" defaultValue={currentItem?.content} placeholder="Write the full article details here..." className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all resize-y leading-relaxed"></textarea>
                            </div>
                            <div>
                                <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Visibility Status</label>
                                <select name="status" defaultValue={currentItem?.published !== false ? 'Published' : 'Draft'} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all appearance-none">
                                    <option value="Published">Published (Visible to public)</option>
                                    <option value="Draft">Draft (Hidden)</option>
                                </select>
                            </div>
                            <div className="pt-6 flex justify-end gap-3 border-t border-slate-100">
                                <button type="button" onClick={() => setInfoModalOpen(false)} className="px-5 py-3 text-slate-600 hover:text-slate-900 bg-white border border-slate-200 rounded-xl font-bold transition-colors">Cancel</button>
                                <button type="submit" className="px-6 py-3 text-white bg-brand-600 rounded-xl hover:bg-brand-700 font-bold shadow-lg shadow-brand-500/30 transition-all hover:-translate-y-0.5">Publish Post</button>
                            </div>
                        </form>
                    </Modal>

                    {/* Course Modal */}
                    <Modal isOpen={isCourseModalOpen} onClose={() => setCourseModalOpen(false)} title={currentItem ? "Edit Course" : "Create Course"} maxWidth="max-w-2xl">
                        <form onSubmit={(e) => handleSave(e, 'courses', setCourseModalOpen, { published: e.target.status.value === 'Active' })} className="space-y-5">
                            <div className="grid grid-cols-2 gap-5">
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Course Title</label>
                                    <input name="title" required defaultValue={currentItem?.title} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all" />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Category</label>
                                    <select name="category" defaultValue={currentItem?.category || 'Tech'} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all appearance-none">
                                        <option value="Tech">Tech</option>
                                        <option value="Design">Design</option>
                                        <option value="Engineering">Engineering</option>
                                    </select>
                                </div>
                            </div>
                            <div className="grid grid-cols-3 gap-5">
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Price (‚Ç¶)</label>
                                    <input name="price" type="number" required defaultValue={currentItem?.price} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all" />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Duration</label>
                                    <input name="duration" required defaultValue={currentItem?.duration} placeholder="e.g. 8 Weeks" className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all" />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Level</label>
                                    <select name="level" defaultValue={currentItem?.level || 'Beginner'} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all appearance-none">
                                        <option value="Beginner">Beginner</option>
                                        <option value="Intermediate">Intermediate</option>
                                        <option value="Advanced">Advanced</option>
                                    </select>
                                </div>
                            </div>
                            <div className="grid grid-cols-2 gap-5">
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Image URL</label>
                                    <input name="image" type="url" required defaultValue={currentItem?.image} placeholder="https://..." className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all" />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Icon Name</label>
                                    <select name="iconName" defaultValue={currentItem?.iconName || 'Code'} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all appearance-none">
                                        <option value="Code">Code (Dev)</option>
                                        <option value="Palette">Palette (UI/UX)</option>
                                        <option value="Zap">Zap (Solar)</option>
                                        <option value="Shield">Shield (Security)</option>
                                        <option value="Database">Database (Backend)</option>
                                        <option value="Video">Video (Editing)</option>
                                        <option value="Megaphone">Megaphone (Marketing)</option>
                                        <option value="Settings">Settings (Hardware)</option>
                                        <option value="ShieldAlert">ShieldAlert (CCTV)</option>
                                        <option value="Plug">Plug (Electrical)</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Short Description</label>
                                <textarea name="description" required rows="2" defaultValue={currentItem?.description} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all resize-none"></textarea>
                            </div>
                            <div>
                                <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Curriculum (One module per line)</label>
                                <textarea name="curriculumRaw" required rows="4" defaultValue={currentItem?.curriculum?.join('\n')} placeholder="Introduction to React&#10;State Management&#10;API Integration..." className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all resize-y leading-relaxed"></textarea>
                            </div>
                            <div>
                                <label className="block text-xs font-bold uppercase tracking-wider text-slate-500 mb-1.5">Status</label>
                                <select name="status" defaultValue={currentItem?.published !== false ? 'Active' : 'Hidden'} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-900 font-medium transition-all appearance-none">
                                    <option value="Active">Active (Visible)</option>
                                    <option value="Hidden">Hidden</option>
                                </select>
                            </div>
                            <div className="pt-6 flex justify-end gap-3 border-t border-slate-100">
                                <button type="button" onClick={() => setCourseModalOpen(false)} className="px-5 py-3 text-slate-600 hover:text-slate-900 bg-white border border-slate-200 rounded-xl font-bold transition-colors">Cancel</button>
                                <button type="submit" className="px-6 py-3 text-white bg-brand-600 rounded-xl hover:bg-brand-700 font-bold shadow-lg shadow-brand-500/30 transition-all hover:-translate-y-0.5">Save Course</button>
                            </div>
                        </form>
                    </Modal>

                    {/* Settings Modal */}
                    <Modal isOpen={isSettingsModalOpen} onClose={() => setSettingsModalOpen(false)} title="Security Settings">
                        <div className="space-y-4">
                            <div className="bg-blue-50 p-4 rounded-xl border border-blue-100 flex gap-3 text-brand-700 text-sm font-medium mb-4">
                                <Info className="shrink-0 mt-0.5"/>
                                <p>Admin accounts and passwords are now managed securely via Firebase Authentication.</p>
                            </div>
                            <p className="text-slate-600 text-sm leading-relaxed">To add a new administrator, change a password, or revoke access, please log in to your <a href="https://console.firebase.google.com/" target="_blank" rel="noopener noreferrer" className="text-brand-600 font-bold hover:underline">Firebase Console</a> and navigate to the <strong>Authentication</strong> tab.</p>
                            <div className="pt-6 flex justify-end gap-3 border-t border-slate-100 mt-4">
                                <button type="button" onClick={() => setSettingsModalOpen(false)} className="px-5 py-3 text-slate-600 hover:text-slate-900 bg-slate-100 border border-transparent hover:border-slate-200 rounded-xl font-bold transition-all">Close Window</button>
                            </div>
                        </div>
                    </Modal>

                    {/* Toasts */}
                    {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
