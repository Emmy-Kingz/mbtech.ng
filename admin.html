<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mbtech Admin Portal | Workspace</title>
    
    <!-- Security Headers & Search Engine Directives -->
    <meta name="robots" content="noindex, nofollow">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://cdn.tailwindcss.com data:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://cdn.tailwindcss.com https://www.gstatic.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://*.googleapis.com https://*.firebaseio.com wss://*.firebaseio.com;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta name="referrer" content="strict-origin-when-cross-origin">

    <link rel="icon" type="image/png" href="favicon.png">

    <!-- Fonts (Mbtech Brand Font: Plus Jakarta Sans) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    colors: { 
                        brand: { 
                            50: '#f0f7ff', 
                            100: '#e0effe', 
                            500: '#0056b3', 
                            600: '#004494', 
                            700: '#003370', 
                            900: '#001a38' 
                        } 
                    }
                }
            }
        }
    </script>

    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        body { background-color: #f8fafc; overflow-x: hidden; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .modal-overlay { animation: fadeIn 0.2s ease-out; }
        .modal-content { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
    </style>
</head>
<body class="text-slate-800 antialiased min-h-screen flex flex-col">
    <div id="root" class="flex-1 flex flex-col"></div>

    <script type="text/babel">
        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyB-EXAMPLE_KEY_KEEP_YOURS", 
            authDomain: "mbtech-97d8c.firebaseapp.com",
            databaseURL: "https://mbtech-97d8c-default-rtdb.firebaseio.com",
            projectId: "mbtech-97d8c",
            storageBucket: "mbtech-97d8c.appspot.com",
            messagingSenderId: "565780521362",
            appId: "1:565780521362:web:9c7ca90479d20c4a4505ee"
        };
        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const db = firebase.database();

        // --- ICONS SET ---
        const Icons = {
            Dashboard: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>,
            Store: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg>,
            Event: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
            Info: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" /></svg>,
            Course: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>,
            Users: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>,
            Settings: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>,
            Plus: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>,
            Edit: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>,
            Delete: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
            Close: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
            LogOut: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>,
            Lock: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>,
            Check: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>,
            Sync: () => <svg className="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>,
            Location: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>,
            Phone: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>,
            Mail: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>,
        };

        // --- CRYPTO HELPER ---
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // --- COMPONENTS ---
        const AnimatedCounter = ({ target, suffix = '' }) => {
            const [count, setCount] = React.useState(0);
            
            React.useEffect(() => {
                let start = 0;
                if (target === 0) return;
                
                const duration = 1500; // Animation lasts 1.5 seconds
                const interval = Math.max(30, duration / target);
                
                const timer = setInterval(() => {
                    start += 1;
                    setCount(start);
                    if (start >= target) clearInterval(timer);
                }, interval);
                
                return () => clearInterval(timer);
            }, [target]);

            return <span>{count}{suffix}</span>;
        };

        const Toast = ({ message, type, onClose }) => {
            React.useEffect(() => { const timer = setTimeout(onClose, 3000); return () => clearTimeout(timer); }, [onClose]);
            const bgClass = type === 'success' ? 'bg-emerald-500' : type === 'error' ? 'bg-red-500' : 'bg-slate-800';
            return (
                <div className="fixed bottom-6 right-6 z-50 animate-[slideUp_0.3s_ease-out]">
                    <div className={bgClass + " text-white px-6 py-3 rounded-xl shadow-lg flex items-center gap-3 font-medium"}>
                        {type === 'success' && <Icons.Check />}
                        {type === 'error' && <Icons.Close />}
                        {message}
                    </div>
                </div>
            );
        };

        const Modal = ({ isOpen, onClose, title, children, maxWidth = "max-w-xl" }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay bg-slate-900/60 backdrop-blur-sm">
                    <div className={"bg-white rounded-2xl shadow-xl w-full max-h-[90vh] flex flex-col modal-content " + maxWidth}>
                        <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50 rounded-t-2xl">
                            <h3 className="text-lg font-bold text-slate-800">{title}</h3>
                            <button type="button" onClick={onClose} className="text-slate-400 hover:text-slate-600 transition-colors p-1 rounded-lg hover:bg-slate-200">
                                <Icons.Close />
                            </button>
                        </div>
                        <div className="p-6 overflow-y-auto hide-scrollbar flex-1">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP COMPONENT ---
        const App = () => {
            const [isAuthenticated, setIsAuthenticated] = React.useState(false);
            const [showLoginForm, setShowLoginForm] = React.useState(false);
            const [passcode, setPasscode] = React.useState('');
            const [authError, setAuthError] = React.useState('');
            const [activeTab, setActiveTab] = React.useState('dashboard');
            const [toast, setToast] = React.useState(null);
            
            // Data State
            const [data, setData] = React.useState({ courses: [], store: [], info: [], connect: [], events: [] });
            const [syncProgress, setSyncProgress] = React.useState(0);
            const [isSyncing, setIsSyncing] = React.useState(true);
            const [isAuthenticating, setIsAuthenticating] = React.useState(false);
            
            // Modal States
            const [currentItem, setCurrentItem] = React.useState(null);
            const [isCourseModalOpen, setCourseModalOpen] = React.useState(false);
            const [isStoreModalOpen, setStoreModalOpen] = React.useState(false);
            const [isEventModalOpen, setEventModalOpen] = React.useState(false);
            const [isInfoModalOpen, setInfoModalOpen] = React.useState(false);
            const [isSettingsModalOpen, setSettingsModalOpen] = React.useState(false);

            // Fetch Data unconditionally (so public overview can show stats)
            React.useEffect(() => {
                const collections = ['courses', 'store', 'info', 'connect', 'events'];
                const loadedSet = new Set();

                // Fallback: Force sync to finish after 8 seconds to prevent getting stuck
                const timeoutId = setTimeout(() => {
                    setIsSyncing(false);
                    setSyncProgress(100);
                }, 8000);

                collections.forEach(col => {
                    db.ref(col).on('value', 
                        (snapshot) => {
                            const val = snapshot.val();
                            const arr = val ? Object.keys(val).map(key => ({ id: key, ...val[key] })) : [];
                            setData(prev => ({ ...prev, [col]: arr.reverse() })); // Reverse to show newest first
                            
                            loadedSet.add(col);
                            const progress = Math.floor((loadedSet.size / collections.length) * 100);
                            setSyncProgress(progress);
                            
                            if (progress === 100) {
                                setIsSyncing(false);
                                clearTimeout(timeoutId);
                            }
                        },
                        (error) => {
                            console.warn(`Could not load ${col}:`, error.message);
                            // If a collection fails (e.g. permission error), still mark it as loaded so the UI doesn't hang
                            loadedSet.add(col);
                            const progress = Math.floor((loadedSet.size / collections.length) * 100);
                            setSyncProgress(progress);
                            
                            if (progress === 100) {
                                setIsSyncing(false);
                                clearTimeout(timeoutId);
                            }
                        }
                    );
                });

                return () => {
                    collections.forEach(col => db.ref(col).off());
                    clearTimeout(timeoutId);
                };
            }, []);

            const handleLogin = async (e) => {
                e.preventDefault();
                setIsAuthenticating(true);
                const inputHash = await sha256(passcode);
                
                // Set the default passcode to 'emmy-admin%%' securely via hashing
                const expectedDefaultHash = await sha256('emmy-admin%%');
                const storedHash = localStorage.getItem('mbtech_admin_hash') || expectedDefaultHash;
                
                if (inputHash === storedHash) {
                    setIsAuthenticated(true);
                    setShowLoginForm(false); // Reset form visibility on success
                    setAuthError('');
                } else {
                    setAuthError('Invalid passcode. Access denied.');
                }
                setIsAuthenticating(false);
            };

            const handleLogout = () => { 
                setIsAuthenticated(false); 
                setShowLoginForm(false); 
                setPasscode(''); 
            };

            const showToast = (message, type = 'success') => setToast({ message, type });

            // CRUD Handlers
            const handleSave = async (e, collection, setModalOpen, extraData = {}) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const payload = Object.fromEntries(formData.entries());
                Object.assign(payload, extraData);
                
                // Convert numbers
                if (payload.price) payload.price = parseFloat(payload.price);
                if (payload.oldPrice) payload.oldPrice = parseFloat(payload.oldPrice);
                if (payload.stock) payload.stock = parseInt(payload.stock);

                try {
                    if (currentItem && currentItem.id) {
                        await db.ref(collection + '/' + currentItem.id).update(payload);
                        showToast(collection.charAt(0).toUpperCase() + collection.slice(1) + ' item updated!');
                    } else {
                        const id = Date.now().toString();
                        await db.ref(collection + '/' + id).set({ ...payload, id, createdAt: new Date().toISOString() });
                        showToast('New ' + collection + ' item created!');
                    }
                    setModalOpen(false);
                    setCurrentItem(null);
                } catch (error) {
                    showToast(error.message, 'error');
                }
            };

            const handleDelete = async (collection, id) => {
                if (window.confirm('Are you sure you want to delete this item from ' + collection + '?')) {
                    try {
                        await db.ref(collection + '/' + id).remove();
                        showToast('Item deleted successfully.');
                    } catch (error) {
                        showToast(error.message, 'error');
                    }
                }
            };

            const handleChangePasscode = async (e) => {
                e.preventDefault();
                const newPass = e.target.newPasscode.value;
                if(newPass.length < 6) { showToast('Passcode must be at least 6 characters', 'error'); return; }
                const hash = await sha256(newPass);
                localStorage.setItem('mbtech_admin_hash', hash);
                showToast('Admin passcode updated securely!');
                setSettingsModalOpen(false);
            };

            const openModal = (item, setModalOpen) => {
                setCurrentItem(item);
                setModalOpen(true);
            };

            // MBTECH Global Footer Component (Adapted from index.html)
            const GlobalFooter = () => (
                <footer className="bg-slate-900 text-white pt-16 pb-8 mt-auto w-full z-10 border-t border-slate-800">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-1 md:grid-cols-4 gap-8 mb-12">
                        <div>
                            <img src="logo.png" alt="MBTECH Logo" className="h-10 mb-4 object-contain" />
                            <p className="text-slate-400 mb-4 text-sm leading-relaxed">
                                Empowering Africa through innovative technology solutions, digital skills training, and sustainable energy.
                            </p>
                            <div className="flex space-x-4">
                                <a href="https://facebook.com/mbtechng" target="_blank" rel="noopener noreferrer" className="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-slate-400 hover:bg-brand-500 hover:text-white transition-colors font-bold text-lg">f</a>
                                <a href="https://twitter.com/mbtechng" target="_blank" rel="noopener noreferrer" className="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-slate-400 hover:bg-brand-500 hover:text-white transition-colors font-bold text-lg">ùïè</a>
                                <a href="https://linkedin.com/company/mbtechng" target="_blank" rel="noopener noreferrer" className="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-slate-400 hover:bg-brand-500 hover:text-white transition-colors font-bold text-lg">in</a>
                            </div>
                        </div>
                        <div>
                            <h4 className="text-lg font-bold mb-4 text-white">Quick Links</h4>
                            <ul className="space-y-2 text-sm text-slate-400">
                                <li><a href="index.html" className="hover:text-brand-500 transition-colors">Home</a></li>
                                <li><a href="course.html" className="hover:text-brand-500 transition-colors">Academy</a></li>
                                <li><a href="store.html" className="hover:text-brand-500 transition-colors">Tech Store</a></li>
                                <li><a href="info.html" className="hover:text-brand-500 transition-colors">Blog & Info</a></li>
                                <li><a href="connect.html" className="hover:text-brand-500 transition-colors">Connect</a></li>
                            </ul>
                        </div>
                        <div>
                            <h4 className="text-lg font-bold mb-4 text-white">Our Services</h4>
                            <ul className="space-y-2 text-sm text-slate-400">
                                <li><span className="hover:text-brand-500 transition-colors cursor-default">Digital Skills Training</span></li>
                                <li><span className="hover:text-brand-500 transition-colors cursor-default">Software Development</span></li>
                                <li><span className="hover:text-brand-500 transition-colors cursor-default">Solar Installation</span></li>
                                <li><span className="hover:text-brand-500 transition-colors cursor-default">Tech Consultancy</span></li>
                            </ul>
                        </div>
                        <div>
                            <h4 className="text-lg font-bold mb-4 text-white">Contact Us</h4>
                            <ul className="space-y-4 text-sm text-slate-400">
                                <li className="flex items-start">
                                    <span className="mr-3 mt-0.5 text-brand-500"><Icons.Location /></span>
                                    <span>Lagos, Nigeria</span>
                                </li>
                                <li className="flex items-center">
                                    <span className="mr-3 text-brand-500"><Icons.Phone /></span>
                                    <span>+234 708 467 2771</span>
                                </li>
                                <li className="flex items-center">
                                    <span className="mr-3 text-brand-500"><Icons.Mail /></span>
                                    <a href="mailto:admin@mbtechng.com" className="hover:text-brand-500 transition-colors">admin@mbtechng.com</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 border-t border-slate-800 pt-8 text-center text-slate-500 text-sm">
                        <p>&copy; {new Date().getFullYear()} Mesobest Technology. All rights reserved. | Secured Workspace</p>
                    </div>
                </footer>
            );

            // Global Progress Bar Component
            const ProgressBar = () => {
                if (!isSyncing) return null;
                return (
                    <div className="w-full bg-slate-100 h-1 overflow-hidden z-40 relative">
                        <div className="bg-brand-500 h-full transition-all duration-300 ease-out" style={{ width: syncProgress + '%' }}></div>
                    </div>
                );
            };

            // Compute Stats
            const activeEventsCount = data.events.filter(e => e.status === 'Active').length;
            const dashboardStats = [
                { label: 'Products in Store', val: data.store.length, icon: Icons.Store, color: 'text-emerald-600', bg: 'bg-emerald-50' },
                { label: 'Blog Posts', val: data.info.length, icon: Icons.Info, color: 'text-purple-600', bg: 'bg-purple-50' },
                { label: 'Active Events', val: activeEventsCount, icon: Icons.Event, color: 'text-blue-600', bg: 'bg-blue-50' },
                { label: 'Total Courses', val: 12, isFixed: true, suffix: '+', icon: Icons.Course, color: 'text-amber-600', bg: 'bg-amber-50' },
            ];

            // --- RENDER VIEW 1: PUBLIC WEBSITE OVERVIEW ---
            if (!isAuthenticated && !showLoginForm) {
                return (
                    <div className="flex-1 flex flex-col bg-slate-50 min-h-screen font-sans">
                        <nav className="bg-white border-b border-slate-200 sticky top-0 z-30 shadow-sm">
                            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                <div className="flex justify-between h-16 items-center">
                                    <div className="flex items-center gap-3">
                                        <img src="logo.png" alt="MBTECH" className="h-8 w-auto object-contain" />
                                        <span className="text-lg font-bold text-slate-900 hidden sm:block border-l border-slate-300 pl-3">Website Overview</span>
                                    </div>
                                    <button onClick={() => setShowLoginForm(true)} className="px-4 py-2 bg-brand-600 hover:bg-brand-700 text-white rounded-lg font-medium text-sm transition-colors shadow-sm flex items-center gap-2">
                                        <Icons.Lock /> <span>Login as Admin</span>
                                    </button>
                                </div>
                            </div>
                        </nav>
                        <ProgressBar />
                        <main className="flex-1 w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
                             <div className="text-center mb-12">
                                 <h1 className="text-3xl sm:text-4xl font-bold text-slate-900 mb-4 tracking-tight">MBTECH System Overview</h1>
                                 <p className="text-slate-600 max-w-2xl mx-auto text-lg">Public analytics dashboard. Log in as an administrator to manage the store, publish blog posts, configure events, and view user inquiries.</p>
                             </div>

                             <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                 {dashboardStats.map((stat, i) => (
                                     <div key={i} className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm flex flex-col items-center text-center gap-4 hover:shadow-md transition-shadow">
                                         <div className={"w-16 h-16 rounded-2xl flex items-center justify-center " + stat.bg + " " + stat.color}>
                                             <stat.icon />
                                         </div>
                                         <div>
                                             <p className="text-4xl font-extrabold text-slate-800 mb-1">
                                                 {isSyncing && stat.val === 0 && !stat.isFixed ? <span className="text-2xl text-slate-400 animate-pulse">...</span> : (stat.isFixed ? <AnimatedCounter target={stat.val} suffix={stat.suffix} /> : <span>{stat.val}</span>)}
                                             </p>
                                             <p className="text-slate-500 font-medium">{stat.label}</p>
                                         </div>
                                     </div>
                                 ))}
                             </div>
                        </main>
                        <GlobalFooter />
                    </div>
                );
            }

            // --- RENDER VIEW 2: LOGIN PASSCODE SCREEN ---
            if (!isAuthenticated && showLoginForm) {
                return (
                    <div className="flex-1 flex flex-col justify-between font-sans">
                        <div className="flex-1 flex items-center justify-center p-4 py-20 bg-slate-50">
                            <div className="bg-white p-8 rounded-3xl shadow-xl w-full max-w-md border border-slate-100 relative">
                                <div className="text-center mb-8">
                                    <img src="logo.png" alt="MBTECH" className="h-14 w-auto mx-auto mb-6 object-contain" />
                                    <h1 className="text-2xl font-bold text-slate-900 mb-2">Workspace Access</h1>
                                    <p className="text-slate-500 text-sm">Enter the master passcode to access the MBTECH portal.</p>
                                </div>
                                <form onSubmit={handleLogin} className="space-y-6">
                                    <div>
                                        <input 
                                            type="password" 
                                            value={passcode} 
                                            onChange={(e) => setPasscode(e.target.value)}
                                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                                            className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none text-center text-xl tracking-[0.5em] text-slate-800 transition-all"
                                            autoFocus
                                            required
                                        />
                                    </div>
                                    {authError && <p className="text-red-500 text-sm text-center font-medium">{authError}</p>}
                                    <button type="submit" disabled={isAuthenticating} className="w-full py-3 px-4 bg-brand-600 hover:bg-brand-700 text-white rounded-xl font-semibold shadow-sm transition-colors flex items-center justify-center gap-2">
                                        {isAuthenticating ? <span>Verifying...</span> : <span>Unlock Workspace</span>}
                                    </button>
                                </form>
                                <div className="mt-8 text-center border-t border-slate-100 pt-6">
                                    <button type="button" onClick={() => setShowLoginForm(false)} className="text-sm font-semibold text-slate-500 hover:text-slate-800 transition-colors">
                                        &larr; Return to Overview
                                    </button>
                                </div>
                            </div>
                        </div>
                        <GlobalFooter />
                    </div>
                );
            }

            // --- RENDER VIEW 3: ADMIN DASHBOARD (Authenticated) ---
            const navItems = [
                { id: 'dashboard', label: 'Dashboard', icon: Icons.Dashboard },
                { id: 'store', label: 'Store', icon: Icons.Store },
                { id: 'events', label: 'Events', icon: Icons.Event },
                { id: 'info', label: 'Blog & Info', icon: Icons.Info },
                { id: 'courses', label: 'Academy', icon: Icons.Course },
                { id: 'connect', label: 'Users & Leads', icon: Icons.Users },
            ];

            return (
                <div className="flex-1 flex flex-col font-sans">
                    {/* Top Navigation */}
                    <nav className="bg-white border-b border-slate-200 sticky top-0 z-30 shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between h-16">
                                <div className="flex overflow-hidden">
                                    <div className="flex-shrink-0 flex items-center gap-3 mr-8">
                                        <img src="logo.png" alt="MBTECH" className="h-8 w-auto object-contain" />
                                        <span className="text-lg font-bold text-slate-900 hidden sm:block border-l border-slate-300 pl-3">Workspace</span>
                                    </div>
                                    
                                    {/* Desktop Tabs */}
                                    <div className="hidden lg:flex space-x-6">
                                        {navItems.map(item => (
                                            <button 
                                                key={item.id} 
                                                onClick={() => setActiveTab(item.id)}
                                                className={"whitespace-nowrap py-4 px-1 border-b-2 font-semibold text-sm flex items-center transition-colors " + (activeTab === item.id ? 'border-brand-600 text-brand-600' : 'border-transparent text-slate-500 hover:text-slate-800 hover:border-slate-300')}
                                            >
                                                <item.icon />
                                                <span className="ml-2">{item.label}</span>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div className="flex items-center space-x-3">
                                    <button onClick={() => setSettingsModalOpen(true)} className="text-slate-400 hover:text-slate-700 p-2 rounded-full hover:bg-slate-100 transition-colors" title="Settings">
                                        <Icons.Settings />
                                    </button>
                                    <button onClick={handleLogout} className="text-slate-400 hover:text-red-500 p-2 rounded-full hover:bg-red-50 transition-colors" title="Logout">
                                        <Icons.LogOut />
                                    </button>
                                </div>
                            </div>
                        </div>
                        {/* Mobile Tabs */}
                        <div className="lg:hidden border-t border-slate-100 bg-slate-50 px-2 py-2 flex overflow-x-auto hide-scrollbar space-x-2 snap-x">
                             {navItems.map(item => (
                                <button 
                                    key={item.id} 
                                    onClick={() => setActiveTab(item.id)}
                                    className={"snap-start whitespace-nowrap px-3 py-2 rounded-lg text-sm font-semibold flex items-center transition-colors " + (activeTab === item.id ? 'bg-brand-100 text-brand-700' : 'text-slate-600 hover:bg-slate-200')}
                                >
                                    <item.icon />
                                    <span className="ml-1.5">{item.label}</span>
                                </button>
                            ))}
                        </div>
                    </nav>
                    <ProgressBar />

                    {/* Main Content Area */}
                    <main className="flex-1 w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {isSyncing && (
                            <div className="mb-6 flex items-center justify-between bg-brand-50 text-brand-700 px-4 py-3 rounded-xl text-sm font-medium border border-brand-100 shadow-sm">
                                <div className="flex items-center gap-3">
                                    <Icons.Sync />
                                    <span>Live syncing with Firebase...</span>
                                </div>
                                <span>{syncProgress}%</span>
                            </div>
                        )}
                        
                        {/* DASHBOARD */}
                        {activeTab === 'dashboard' && (
                            <div className="space-y-6">
                                <h2 className="text-2xl font-bold text-slate-800">System Dashboard</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                    {dashboardStats.map((stat, i) => (
                                        <div key={i} className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm flex items-center gap-5 hover:shadow-md transition-shadow">
                                            <div className={"w-14 h-14 rounded-xl flex items-center justify-center " + stat.bg + " " + stat.color}>
                                                <stat.icon />
                                            </div>
                                            <div>
                                                <p className="text-slate-500 text-sm font-semibold">{stat.label}</p>
                                                <p className="text-3xl font-bold text-slate-800 mt-1">
                                                    {isSyncing && stat.val === 0 && !stat.isFixed ? <span className="text-xl text-slate-400 animate-pulse">...</span> : (stat.isFixed ? <AnimatedCounter target={stat.val} suffix={stat.suffix} /> : <span>{stat.val}</span>)}
                                                </p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* STORE TAB */}
                        {activeTab === 'store' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-slate-800">Store Inventory</h2>
                                    <button onClick={() => openModal(null, setStoreModalOpen)} className="bg-brand-600 hover:bg-brand-700 text-white px-5 py-2.5 rounded-xl font-medium flex items-center shadow-sm transition-colors">
                                        <Icons.Plus /> <span className="ml-2">Add Item</span>
                                    </button>
                                </div>
                                <div className="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden w-full">
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-left border-collapse min-w-[800px]">
                                            <thead>
                                                <tr className="bg-slate-50 text-slate-500 text-sm border-b border-slate-200 whitespace-nowrap">
                                                    <th className="p-4 font-semibold">Product</th>
                                                    <th className="p-4 font-semibold">Category</th>
                                                    <th className="p-4 font-semibold">Type</th>
                                                    <th className="p-4 font-semibold">Price (‚Ç¶)</th>
                                                    <th className="p-4 font-semibold">Stock</th>
                                                    <th className="p-4 font-semibold text-right">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-100">
                                                {data.store.map(item => (
                                                    <tr key={item.id} className="hover:bg-slate-50 transition-colors">
                                                        <td className="p-4 flex items-center gap-4 min-w-[250px]">
                                                            <img src={item.image} alt="" className="w-12 h-12 rounded-lg object-cover bg-slate-100 border border-slate-200 flex-shrink-0" onError={(e) => { e.target.src='https://placehold.co/100?text=IMG' }} />
                                                            <span className="font-semibold text-slate-800 line-clamp-2">{item.name}</span>
                                                        </td>
                                                        <td className="p-4 text-sm text-slate-600 whitespace-nowrap">{item.category}</td>
                                                        <td className="p-4 whitespace-nowrap">
                                                            <span className={"text-xs font-bold px-2.5 py-1 rounded-md " + (item.type === 'service' ? 'bg-purple-50 text-purple-700' : 'bg-blue-50 text-blue-700')}>
                                                                {item.type === 'service' ? 'Service' : 'Good'}
                                                            </span>
                                                        </td>
                                                        <td className="p-4 text-sm font-bold text-slate-800 whitespace-nowrap">{parseFloat(item.price).toLocaleString()}</td>
                                                        <td className="p-4 whitespace-nowrap">
                                                            <span className={"text-sm font-semibold " + (item.stock <= 5 ? 'text-red-600' : 'text-emerald-600')}>{item.stock}</span>
                                                        </td>
                                                        <td className="p-4 text-right whitespace-nowrap">
                                                            <div className="flex justify-end gap-2">
                                                                <button onClick={() => openModal(item, setStoreModalOpen)} className="p-2 text-slate-400 hover:text-brand-600 bg-white border border-slate-200 hover:border-brand-200 rounded-lg shadow-sm"><Icons.Edit /></button>
                                                                <button onClick={() => handleDelete('store', item.id)} className="p-2 text-slate-400 hover:text-red-600 bg-white border border-slate-200 hover:border-red-200 rounded-lg shadow-sm"><Icons.Delete /></button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                        {data.store.length === 0 && (
                                            <div className="p-12 text-center text-slate-500">
                                                {isSyncing ? <span>Syncing data... ({syncProgress}%)</span> : <span>Store is empty. Add your first product.</span>}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* EVENTS TAB */}
                        {activeTab === 'events' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-slate-800">Events Management</h2>
                                    <button onClick={() => openModal(null, setEventModalOpen)} className="bg-brand-600 hover:bg-brand-700 text-white px-5 py-2.5 rounded-xl font-medium flex items-center shadow-sm transition-colors">
                                        <Icons.Plus /> <span className="ml-2">Create Event</span>
                                    </button>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {data.events.map(event => (
                                        <div key={event.id} className="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden flex flex-col group">
                                            <div className="h-48 bg-slate-100 relative overflow-hidden">
                                                <img src={event.image || 'https://placehold.co/600x400?text=Event'} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
                                                <div className={"absolute top-3 right-3 px-3 py-1 rounded-md text-xs font-bold shadow-sm " + (event.status === 'Active' ? 'bg-brand-600 text-white' : event.status === 'Cancelled' ? 'bg-red-600 text-white' : 'bg-slate-800 text-white')}>
                                                    {event.status}
                                                </div>
                                            </div>
                                            <div className="p-5 flex-1 flex flex-col">
                                                <h3 className="font-bold text-lg text-slate-800 leading-tight mb-1">{event.title}</h3>
                                                <p className="text-sm text-brand-600 font-medium mb-3">{event.date} &#8226; {event.time}</p>
                                                <p className="text-sm text-slate-500 line-clamp-2 mb-4 flex-1">{event.description}</p>
                                                <div className="flex items-center justify-between pt-4 border-t border-slate-100">
                                                    <span className="text-xs font-medium text-slate-500 truncate max-w-[150px]" title={event.location}>
                                                        <span role="img" aria-label="location">&#128205;</span> {event.location}
                                                    </span>
                                                    <div className="flex gap-2 flex-shrink-0">
                                                        <button onClick={() => openModal(event, setEventModalOpen)} className="p-2 text-slate-400 hover:text-brand-600 bg-slate-50 hover:bg-brand-50 rounded-lg transition-colors"><Icons.Edit /></button>
                                                        <button onClick={() => handleDelete('events', event.id)} className="p-2 text-slate-400 hover:text-red-600 bg-slate-50 hover:bg-red-50 rounded-lg transition-colors"><Icons.Delete /></button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                    {data.events.length === 0 && (
                                        <div className="col-span-full py-12 text-center text-slate-400 bg-white rounded-2xl border border-slate-200">
                                            {isSyncing ? <span>Syncing data... ({syncProgress}%)</span> : <span>No events found. Create one above.</span>}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* INFO/BLOG TAB */}
                        {activeTab === 'info' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-slate-800">Blog & News</h2>
                                    <button onClick={() => openModal(null, setInfoModalOpen)} className="bg-brand-600 hover:bg-brand-700 text-white px-5 py-2.5 rounded-xl font-medium flex items-center shadow-sm transition-colors">
                                        <Icons.Plus /> <span className="ml-2">Write Post</span>
                                    </button>
                                </div>
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    {data.info.map(post => (
                                        <div key={post.id} className="bg-white rounded-2xl border border-slate-200 shadow-sm p-5 flex flex-col sm:flex-row gap-5 hover:shadow-md transition-all">
                                            <div className="w-full sm:w-32 h-40 sm:h-32 rounded-xl bg-slate-100 flex-shrink-0 overflow-hidden relative">
                                                <img src={post.image || 'https://placehold.co/400?text=News'} className="w-full h-full object-cover" alt="" />
                                                {!post.published && <div className="absolute inset-0 bg-slate-900/60 flex items-center justify-center text-white text-xs font-bold tracking-wider">DRAFT</div>}
                                            </div>
                                            <div className="flex-1 flex flex-col justify-between">
                                                <div>
                                                    <div className="flex gap-2 mb-2">
                                                        <span className="text-[10px] font-bold uppercase tracking-wider text-brand-700 bg-brand-50 px-2.5 py-1 rounded-md">{post.category}</span>
                                                        <span className="text-[10px] font-bold uppercase tracking-wider text-slate-500 bg-slate-100 px-2.5 py-1 rounded-md">{post.date}</span>
                                                    </div>
                                                    <h3 className="font-bold text-slate-800 text-lg leading-tight mb-2">{post.title}</h3>
                                                    <p className="text-sm text-slate-600 line-clamp-2">{post.excerpt}</p>
                                                </div>
                                                <div className="flex justify-end gap-2 mt-4 pt-4 border-t border-slate-100">
                                                    <button onClick={() => openModal(post, setInfoModalOpen)} className="text-xs font-bold text-slate-600 hover:text-brand-700 px-3 py-1.5 bg-slate-50 hover:bg-brand-50 rounded-lg transition-colors border border-slate-200">Edit Post</button>
                                                    <button onClick={() => handleDelete('info', post.id)} className="text-xs font-bold text-slate-600 hover:text-red-700 px-3 py-1.5 bg-slate-50 hover:bg-red-50 rounded-lg transition-colors border border-slate-200">Delete</button>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                    {data.info.length === 0 && (
                                        <div className="col-span-full py-12 text-center text-slate-500 bg-white rounded-2xl border border-slate-200">
                                            {isSyncing ? <span>Syncing data... ({syncProgress}%)</span> : <span>No articles published yet.</span>}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* COURSES TAB */}
                        {activeTab === 'courses' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-slate-800">Academy Programs</h2>
                                    <button onClick={() => openModal(null, setCourseModalOpen)} className="bg-brand-600 hover:bg-brand-700 text-white px-5 py-2.5 rounded-xl font-medium flex items-center shadow-sm transition-colors">
                                        <Icons.Plus /> <span className="ml-2">Add Course</span>
                                    </button>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {data.courses.map(course => (
                                        <div key={course.id} className="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden flex flex-col group">
                                            <div className="h-48 bg-slate-100 relative overflow-hidden">
                                                <img src={course.image || 'https://placehold.co/600x400?text=No+Image'} alt={course.title} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
                                                <div className="absolute top-3 right-3 bg-white/90 backdrop-blur-sm px-3 py-1 rounded-md text-xs font-bold text-slate-800 shadow-sm">
                                                    ‚Ç¶{parseFloat(course.price).toLocaleString()}
                                                </div>
                                            </div>
                                            <div className="p-5 flex-1 flex flex-col">
                                                <h3 className="font-bold text-lg text-slate-800 leading-tight mb-2">{course.title}</h3>
                                                <p className="text-sm text-slate-500 line-clamp-2 mb-4 flex-1">{course.description}</p>
                                                <div className="flex items-center justify-between pt-4 border-t border-slate-100">
                                                    <span className={"text-xs font-bold px-2.5 py-1 rounded-md " + (course.status === 'Active' ? 'bg-emerald-50 text-emerald-600' : 'bg-slate-100 text-slate-500')}>{course.status}</span>
                                                    <div className="flex gap-2">
                                                        <button onClick={() => openModal(course, setCourseModalOpen)} className="p-2 text-slate-400 hover:text-brand-600 bg-slate-50 hover:bg-brand-50 rounded-lg transition-colors"><Icons.Edit /></button>
                                                        <button onClick={() => handleDelete('courses', course.id)} className="p-2 text-slate-400 hover:text-red-600 bg-slate-50 hover:bg-red-50 rounded-lg transition-colors"><Icons.Delete /></button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                    {data.courses.length === 0 && (
                                        <div className="col-span-full py-12 text-center text-slate-400 bg-white rounded-2xl border border-slate-200">
                                            {isSyncing ? <span>Syncing data... ({syncProgress}%)</span> : <span>No courses found. Create one above.</span>}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* CONNECT (USERS & LEADS) TAB */}
                        {activeTab === 'connect' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-slate-800">User Inquiries</h2>
                                </div>
                                <div className="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden w-full">
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-left border-collapse min-w-[800px]">
                                            <thead>
                                                <tr className="bg-slate-50 text-slate-500 text-sm border-b border-slate-200 whitespace-nowrap">
                                                    <th className="p-4 font-semibold">Date</th>
                                                    <th className="p-4 font-semibold">Contact Info</th>
                                                    <th className="p-4 font-semibold">Interest/Service</th>
                                                    <th className="p-4 font-semibold">Message</th>
                                                    <th className="p-4 font-semibold text-right">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-100">
                                                {data.connect.map(lead => (
                                                    <tr key={lead.id} className="hover:bg-slate-50 transition-colors">
                                                        <td className="p-4 text-sm text-slate-500 whitespace-nowrap">{new Date(lead.createdAt).toLocaleDateString()}</td>
                                                        <td className="p-4 min-w-[200px]">
                                                            <p className="font-semibold text-slate-800">{lead.name}</p>
                                                            <p className="text-sm text-brand-600"><a href={"mailto:" + lead.email}>{lead.email}</a></p>
                                                            <p className="text-xs text-slate-500">{lead.phone}</p>
                                                        </td>
                                                        <td className="p-4 text-sm font-medium text-slate-700 whitespace-nowrap">{lead.service}</td>
                                                        <td className="p-4 text-sm text-slate-600 max-w-xs truncate" title={lead.message}>{lead.message || '-'}</td>
                                                        <td className="p-4 text-right whitespace-nowrap">
                                                            <button onClick={() => handleDelete('connect', lead.id)} className="p-2 text-slate-400 hover:text-red-600 bg-white border border-slate-200 hover:border-red-200 rounded-lg shadow-sm"><Icons.Delete /></button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                        {data.connect.length === 0 && (
                                            <div className="p-12 text-center text-slate-500">
                                                {isSyncing ? <span>Syncing data... ({syncProgress}%)</span> : <span>No leads captured yet.</span>}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Global Footer (Dashboard View) */}
                    <GlobalFooter />

                    {/* MODALS */}
                    
                    {/* Store Modal */}
                    <Modal isOpen={isStoreModalOpen} onClose={() => setStoreModalOpen(false)} title={currentItem ? "Edit Product/Service" : "Add to Store"}>
                        <form onSubmit={(e) => handleSave(e, 'store', setStoreModalOpen)} className="space-y-4">
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-1">Item Name</label>
                                <input name="name" required defaultValue={currentItem?.name} className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all shadow-sm" />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-semibold text-slate-700 mb-1">Category</label>
                                    <select name="category" defaultValue={currentItem?.category || 'Solar & Energy'} className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all appearance-none cursor-pointer shadow-sm">
                                        <option value="Solar & Energy">Solar & Energy</option>
                                        <option value="Gadgets">Gadgets</option>
                                        <option value="Electricals">Electricals</option>
                                        <option value="Software">Software</option>
                                        <option value="Services">Services</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-semibold text-slate-700 mb-1">Product Type</label>
                                    <select name="type" defaultValue={currentItem?.type || 'good'} className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all appearance-none cursor-pointer shadow-sm">
                                        <option value="good">Physical Good</option>
                                        <option value="service">Service / Installation</option>
                                    </select>
                                </div>
                            </div>
                            <div className="grid grid-cols-3 gap-4">
                                <div>
                                    <label className="block text-sm font-semibold text-slate-700 mb-1">Price (‚Ç¶)</label>
                                    <input name="price" type="number" required defaultValue={currentItem?.price} className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all shadow-sm" />
                                </div>
                                <div>
                                    <label className="block text-sm font-semibold text-slate-700 mb-1">Old Price (‚Ç¶)</label>
                                    <input name="oldPrice" type="number" defaultValue={currentItem?.oldPrice} className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all shadow-sm" />
                                </div>
                                <div>
                                    <label className="block text-sm font-semibold text-slate-700 mb-1">Stock</label>
                                    <input name="stock" type="number" required defaultValue={currentItem?.stock || 10} className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all shadow-sm" />
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-1">Image URL</label>
                                <input name="image" type="url" required defaultValue={currentItem?.image} placeholder="https://..." className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all shadow-sm" />
                            </div>
                            <div className="pt-4 flex justify-end gap-3 border-t border-slate-100 mt-4">
                                <button type="button" onClick={() => setStoreModalOpen(false)} className="px-4 py-2 text-slate-600 hover:text-slate-900 bg-white border border-slate-200 rounded-lg font-medium transition-colors">Cancel</button>
                                <button type="submit" className="px-5 py-2.5 text-white bg-brand-600 rounded-xl hover:bg-brand-700 font-medium shadow-sm transition-all">Save Item</button>
                            </div>
                        </form>
                    </Modal>

                    {/* Events Modal */}
                    <Modal isOpen={isEventModalOpen} onClose={() => setEventModalOpen(false)} title={currentItem ? "Edit Event" : "Create Event"}>
                        <form onSubmit={(e) => handleSave(e, 'events', setEventModalOpen)} className="space-y-4">
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-1">Event Title</label>
                                <input name="title" required defaultValue={currentItem?.title} className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all shadow-sm" />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-semibold text-slate-700 mb-1">Date</label>
                                    <input name="date" type="date" required defaultValue={currentItem?.date} className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all shadow-sm" />
                                </div>
                                <div>
                                    <label className="block text-sm font-semibold text-slate-700 mb-1">Time</label>
                                    <input name="time" type="time" required defaultValue={currentItem?.time} className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all shadow-sm" />
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-1">Location / Meeting Link</label>
                                <input name="location" required defaultValue={currentItem?.location} placeholder="e.g., Google Meet Link or Office Address" className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all shadow-sm" />
                            </div>
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-1">Image URL</label>
                                <input name="image" type="url" required defaultValue={currentItem?.image} placeholder="https://..." className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all shadow-sm" />
                            </div>
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-1">Description</label>
                                <textarea name="description" required rows="3" defaultValue={currentItem?.description} className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all resize-none shadow-sm"></textarea>
                            </div>
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-1">Status</label>
                                <select name="status" defaultValue={currentItem?.status || 'Active'} className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all appearance-none cursor-pointer shadow-sm">
                                    <option value="Active">Active</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Cancelled">Cancelled</option>
                                </select>
                            </div>
                            <div className="pt-4 flex justify-end gap-3 border-t border-slate-100 mt-4">
                                <button type="button" onClick={() => setEventModalOpen(false)} className="px-4 py-2 text-slate-600 hover:text-slate-900 bg-white border border-slate-200 rounded-lg font-medium transition-colors">Cancel</button>
                                <button type="submit" className="px-5 py-2.5 text-white bg-brand-600 rounded-xl hover:bg-brand-700 font-medium shadow-sm transition-all">Save Event</button>
                            </div>
                        </form>
                    </Modal>

                    {/* Info Modal */}
                    <Modal isOpen={isInfoModalOpen} onClose={() => setInfoModalOpen(false)} title={currentItem ? "Edit Blog Post" : "Write Blog Post"} maxWidth="max-w-2xl">
                        <form onSubmit={(e) => handleSave(e, 'info', setInfoModalOpen, { date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }), author: 'MBTECH Admin', published: e.target.status.value === 'Published' })} className="space-y-4">
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-semibold text-slate-700 mb-1">Post Title</label>
                                    <input name="title" required defaultValue={currentItem?.title} className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all shadow-sm" />
                                </div>
                                <div>
                                    <label className="block text-sm font-semibold text-slate-700 mb-1">Category</label>
                                    <input name="category" required defaultValue={currentItem?.category || 'Updates'} placeholder="e.g. Tech News, Academy" className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all shadow-sm" />
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-1">Cover Image URL</label>
                                <input name="image" type="url" required defaultValue={currentItem?.image} placeholder="https://..." className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all shadow-sm" />
                            </div>
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-1">Short Excerpt (For Homepage Preview)</label>
                                <textarea name="excerpt" required rows="2" defaultValue={currentItem?.excerpt} placeholder="A quick summary..." className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all resize-none shadow-sm"></textarea>
                            </div>
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-1">Full Blog Content</label>
                                <textarea name="content" required rows="10" defaultValue={currentItem?.content} placeholder="Write the full article details here..." className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all resize-y leading-relaxed shadow-sm"></textarea>
                            </div>
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-1">Visibility Status</label>
                                <select name="status" defaultValue={currentItem?.published ? 'Published' : 'Draft'} className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all appearance-none cursor-pointer shadow-sm">
                                    <option value="Published">Published (Visible to public)</option>
                                    <option value="Draft">Draft (Hidden)</option>
                                </select>
                            </div>
                            <div className="pt-4 flex justify-end gap-3 border-t border-slate-100 mt-4">
                                <button type="button" onClick={() => setInfoModalOpen(false)} className="px-4 py-2 text-slate-600 hover:text-slate-900 bg-white border border-slate-200 rounded-lg font-medium transition-colors">Cancel</button>
                                <button type="submit" className="px-5 py-2.5 text-white bg-brand-600 rounded-xl hover:bg-brand-700 font-medium shadow-sm transition-all">Save Post</button>
                            </div>
                        </form>
                    </Modal>

                    {/* Course Modal */}
                    <Modal isOpen={isCourseModalOpen} onClose={() => setCourseModalOpen(false)} title={currentItem ? "Edit Course" : "Create Course"}>
                        <form onSubmit={(e) => handleSave(e, 'courses', setCourseModalOpen)} className="space-y-4">
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-1">Course Title</label>
                                <input name="title" required defaultValue={currentItem?.title} className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all shadow-sm" />
                            </div>
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-1">Description</label>
                                <textarea name="description" required rows="3" defaultValue={currentItem?.description} className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all resize-none shadow-sm"></textarea>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-semibold text-slate-700 mb-1">Price (‚Ç¶)</label>
                                    <input name="price" type="number" required defaultValue={currentItem?.price} className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all shadow-sm" />
                                </div>
                                <div>
                                    <label className="block text-sm font-semibold text-slate-700 mb-1">Duration</label>
                                    <input name="duration" required defaultValue={currentItem?.duration} placeholder="e.g. 8 Weeks" className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all shadow-sm" />
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-1">Image URL</label>
                                <input name="image" type="url" required defaultValue={currentItem?.image} placeholder="https://..." className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all shadow-sm" />
                            </div>
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-1">Status</label>
                                <select name="status" defaultValue={currentItem?.status || 'Active'} className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all appearance-none cursor-pointer shadow-sm">
                                    <option value="Active">Active</option>
                                    <option value="Upcoming">Upcoming</option>
                                </select>
                            </div>
                            <div className="pt-4 flex justify-end gap-3 border-t border-slate-100 mt-4">
                                <button type="button" onClick={() => setCourseModalOpen(false)} className="px-4 py-2 text-slate-600 hover:text-slate-900 bg-white border border-slate-200 rounded-lg font-medium transition-colors">Cancel</button>
                                <button type="submit" className="px-5 py-2.5 text-white bg-brand-600 rounded-xl hover:bg-brand-700 font-medium shadow-sm transition-all">Save Course</button>
                            </div>
                        </form>
                    </Modal>

                    {/* Settings Modal */}
                    <Modal isOpen={isSettingsModalOpen} onClose={() => setSettingsModalOpen(false)} title="Security Settings">
                        <form onSubmit={handleChangePasscode} className="space-y-4">
                            <p className="text-sm text-slate-500 mb-4">Change the master passcode used to access this admin portal. Keep it secure.</p>
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-1">New Passcode</label>
                                <input name="newPasscode" type="password" required minLength="6" placeholder="Enter new passcode" className="w-full px-4 py-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none text-slate-900 transition-all tracking-widest shadow-sm" />
                            </div>
                            <div className="pt-4 flex justify-end gap-3 border-t border-slate-100 mt-4">
                                <button type="button" onClick={() => setSettingsModalOpen(false)} className="px-4 py-2 text-slate-600 hover:text-slate-900 bg-white border border-slate-200 rounded-lg font-medium transition-colors">Cancel</button>
                                <button type="submit" className="px-5 py-2.5 text-white bg-brand-600 rounded-xl hover:bg-brand-700 font-medium shadow-sm transition-all flex items-center justify-center">
                                    <Icons.Lock /> <span className="ml-2">Save Encrypted Passcode</span>
                                </button>
                            </div>
                        </form>
                    </Modal>

                    {/* Toasts */}
                    {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
